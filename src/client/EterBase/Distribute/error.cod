; Listing generated by Microsoft (R) Optimizing Compiler Version 19.28.29335.0 

	TITLE	D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?fException@@3PAU_iobuf@@A			; fException
_BSS	SEGMENT
?fException@@3PAU_iobuf@@A DD 01H DUP (?)		; fException
_BSS	ENDS
PUBLIC	___local_stdio_printf_options
PUBLIC	_fprintf
PUBLIC	?EnumerateLoadedModulesProc@@YGHPBDKKPAX@Z	; EnumerateLoadedModulesProc
PUBLIC	?EterExceptionFilter@@YGJPAU_EXCEPTION_POINTERS@@@Z ; EterExceptionFilter
PUBLIC	?SetEterExceptionHandler@@YAXXZ			; SetEterExceptionHandler
PUBLIC	?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA ; `__local_stdio_printf_options'::`2'::_OptionsStorage
PUBLIC	??_C@_02DKCKIIND@?$CFs@				; `string'
PUBLIC	??_C@_02BKFDOEMK@wt@				; `string'
PUBLIC	??_C@_0N@FNIPCMMK@ErrorLog?4txt@		; `string'
PUBLIC	??_C@_0BB@MMHGDGEH@Module?5Name?3?5?$CFs?6@	; `string'
PUBLIC	??_C@_0BJ@GCEEGBIB@Time?5Stamp?3?50x?$CF08x?5?9?5?$CFs?6@ ; `string'
PUBLIC	??_C@_01EEMJAFIK@?6@				; `string'
PUBLIC	??_C@_0BI@KGPMOIII@Exception?5Type?3?50x?$CF08x?6@ ; `string'
PUBLIC	??_C@_0BJ@IEACADHK@eax?3?50x?$CF08x?7ebx?3?50x?$CF08x?6@ ; `string'
PUBLIC	??_C@_0BJ@LCAEGKJF@ecx?3?50x?$CF08x?7edx?3?50x?$CF08x?6@ ; `string'
PUBLIC	??_C@_0BJ@DIBGGCDL@esi?3?50x?$CF08x?7edi?3?50x?$CF08x?6@ ; `string'
PUBLIC	??_C@_0BJ@PBNLKJKC@ebp?3?50x?$CF08x?7esp?3?50x?$CF08x?6@ ; `string'
PUBLIC	??_C@_07IIGIJDEL@0x?$CF08x?7@			; `string'
PUBLIC	??_C@_0N@KMPLBGID@errorlog?4exe@		; `string'
EXTRN	__imp__SetUnhandledExceptionFilter@4:PROC
EXTRN	__imp__GetCurrentProcess@0:PROC
EXTRN	__imp__GetCurrentThread@0:PROC
EXTRN	__imp__GetModuleFileNameA@12:PROC
EXTRN	__imp__GetModuleHandleA@4:PROC
EXTRN	__imp__WinExec@8:PROC
EXTRN	_fclose:PROC
EXTRN	_fflush:PROC
EXTRN	_fopen:PROC
EXTRN	___stdio_common_vfprintf:PROC
EXTRN	__imp__StackWalk@36:PROC
EXTRN	__imp__GetTimestampForLoadedLibrary@4:PROC
EXTRN	__imp__EnumerateLoadedModules@12:PROC
EXTRN	__ctime64:PROC
EXTRN	@__security_check_cookie@4:PROC
EXTRN	_memset:PROC
EXTRN	___security_cookie:DWORD
;	COMDAT ?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA
_BSS	SEGMENT
?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA DQ 01H DUP (?) ; `__local_stdio_printf_options'::`2'::_OptionsStorage
_BSS	ENDS
;	COMDAT ??_C@_0N@KMPLBGID@errorlog?4exe@
CONST	SEGMENT
??_C@_0N@KMPLBGID@errorlog?4exe@ DB 'errorlog.exe', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_07IIGIJDEL@0x?$CF08x?7@
CONST	SEGMENT
??_C@_07IIGIJDEL@0x?$CF08x?7@ DB '0x%08x', 09H, 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@PBNLKJKC@ebp?3?50x?$CF08x?7esp?3?50x?$CF08x?6@
CONST	SEGMENT
??_C@_0BJ@PBNLKJKC@ebp?3?50x?$CF08x?7esp?3?50x?$CF08x?6@ DB 'ebp: 0x%08x', 09H
	DB	'esp: 0x%08x', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@DIBGGCDL@esi?3?50x?$CF08x?7edi?3?50x?$CF08x?6@
CONST	SEGMENT
??_C@_0BJ@DIBGGCDL@esi?3?50x?$CF08x?7edi?3?50x?$CF08x?6@ DB 'esi: 0x%08x', 09H
	DB	'edi: 0x%08x', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@LCAEGKJF@ecx?3?50x?$CF08x?7edx?3?50x?$CF08x?6@
CONST	SEGMENT
??_C@_0BJ@LCAEGKJF@ecx?3?50x?$CF08x?7edx?3?50x?$CF08x?6@ DB 'ecx: 0x%08x', 09H
	DB	'edx: 0x%08x', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@IEACADHK@eax?3?50x?$CF08x?7ebx?3?50x?$CF08x?6@
CONST	SEGMENT
??_C@_0BJ@IEACADHK@eax?3?50x?$CF08x?7ebx?3?50x?$CF08x?6@ DB 'eax: 0x%08x', 09H
	DB	'ebx: 0x%08x', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BI@KGPMOIII@Exception?5Type?3?50x?$CF08x?6@
CONST	SEGMENT
??_C@_0BI@KGPMOIII@Exception?5Type?3?50x?$CF08x?6@ DB 'Exception Type: 0x'
	DB	'%08x', 0aH, 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_01EEMJAFIK@?6@
CONST	SEGMENT
??_C@_01EEMJAFIK@?6@ DB 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@GCEEGBIB@Time?5Stamp?3?50x?$CF08x?5?9?5?$CFs?6@
CONST	SEGMENT
??_C@_0BJ@GCEEGBIB@Time?5Stamp?3?50x?$CF08x?5?9?5?$CFs?6@ DB 'Time Stamp:'
	DB	' 0x%08x - %s', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BB@MMHGDGEH@Module?5Name?3?5?$CFs?6@
CONST	SEGMENT
??_C@_0BB@MMHGDGEH@Module?5Name?3?5?$CFs?6@ DB 'Module Name: %s', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0N@FNIPCMMK@ErrorLog?4txt@
CONST	SEGMENT
??_C@_0N@FNIPCMMK@ErrorLog?4txt@ DB 'ErrorLog.txt', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_02BKFDOEMK@wt@
CONST	SEGMENT
??_C@_02BKFDOEMK@wt@ DB 'wt', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_02DKCKIIND@?$CFs@
CONST	SEGMENT
??_C@_02DKCKIIND@?$CFs@ DB '%s', 00H			; `string'
CONST	ENDS
; Function compile flags: /Ogtp
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp
;	COMDAT ?SetEterExceptionHandler@@YAXXZ
_TEXT	SEGMENT
?SetEterExceptionHandler@@YAXXZ PROC			; SetEterExceptionHandler, COMDAT

; 207  : 	SetUnhandledExceptionFilter(EterExceptionFilter);

  00000	68 00 00 00 00	 push	 OFFSET ?EterExceptionFilter@@YGJPAU_EXCEPTION_POINTERS@@@Z ; EterExceptionFilter
  00005	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__SetUnhandledExceptionFilter@4

; 208  : }

  0000b	c3		 ret	 0
?SetEterExceptionHandler@@YAXXZ ENDP			; SetEterExceptionHandler
_TEXT	ENDS
; Function compile flags: /Ogtp
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\time.h
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp
;	COMDAT ?EterExceptionFilter@@YGJPAU_EXCEPTION_POINTERS@@@Z
_TEXT	SEGMENT
_hThread$1$ = -436					; size = 4
_module_time$1 = -432					; size = 8
_stackFrame$2 = -424					; size = 164
_module_name$3 = -260					; size = 256
__$ArrayPad$ = -4					; size = 4
_pExceptionInfo$ = 8					; size = 4
?EterExceptionFilter@@YGJPAU_EXCEPTION_POINTERS@@@Z PROC ; EterExceptionFilter, COMDAT

; 43   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	81 ec b4 01 00
	00		 sub	 esp, 436		; 000001b4H
  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  0000e	33 c5		 xor	 eax, ebp
  00010	89 45 fc	 mov	 DWORD PTR __$ArrayPad$[ebp], eax
  00013	53		 push	 ebx
  00014	8b 5d 08	 mov	 ebx, DWORD PTR _pExceptionInfo$[ebp]
  00017	57		 push	 edi

; 44   : 	HANDLE		hProcess	= GetCurrentProcess();

  00018	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetCurrentProcess@0
  0001e	8b f8		 mov	 edi, eax

; 45   : 	HANDLE		hThread		= GetCurrentThread();

  00020	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetCurrentThread@0

; 46   : 	
; 47   : 	fException = fopen("ErrorLog.txt", "wt");

  00026	68 00 00 00 00	 push	 OFFSET ??_C@_02BKFDOEMK@wt@
  0002b	68 00 00 00 00	 push	 OFFSET ??_C@_0N@FNIPCMMK@ErrorLog?4txt@
  00030	89 85 4c fe ff
	ff		 mov	 DWORD PTR _hThread$1$[ebp], eax
  00036	e8 00 00 00 00	 call	 _fopen
  0003b	83 c4 08	 add	 esp, 8
  0003e	a3 00 00 00 00	 mov	 DWORD PTR ?fException@@3PAU_iobuf@@A, eax ; fException

; 48   : 	if (fException)

  00043	85 c0		 test	 eax, eax
  00045	0f 84 47 02 00
	00		 je	 $LN15@EterExcept

; 49   : 	{
; 50   : 		char module_name[256];
; 51   : 		time_t module_time;
; 52   : 		
; 53   : 		HMODULE hModule = GetModuleHandle(NULL);

  0004b	56		 push	 esi
  0004c	6a 00		 push	 0
  0004e	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetModuleHandleA@4
  00054	8b f0		 mov	 esi, eax

; 54   : 		
; 55   : 		GetModuleFileName(hModule, module_name, sizeof(module_name));

  00056	8d 85 fc fe ff
	ff		 lea	 eax, DWORD PTR _module_name$3[ebp]
  0005c	68 00 01 00 00	 push	 256			; 00000100H
  00061	50		 push	 eax
  00062	56		 push	 esi
  00063	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetModuleFileNameA@12

; 56   : 		module_time = (time_t)GetTimestampForLoadedLibrary(hModule);

  00069	56		 push	 esi
  0006a	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetTimestampForLoadedLibrary@4
  00070	89 85 50 fe ff
	ff		 mov	 DWORD PTR _module_time$1[ebp], eax

; 57   : 		
; 58   : 		fprintf(fException, "Module Name: %s\n", module_name);

  00076	8d 85 fc fe ff
	ff		 lea	 eax, DWORD PTR _module_name$3[ebp]
  0007c	50		 push	 eax
  0007d	68 00 00 00 00	 push	 OFFSET ??_C@_0BB@MMHGDGEH@Module?5Name?3?5?$CFs?6@
  00082	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00088	c7 85 54 fe ff
	ff 00 00 00 00	 mov	 DWORD PTR _module_time$1[ebp+4], 0
  00092	e8 00 00 00 00	 call	 _fprintf
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\time.h

; 482  :             return _ctime64(_Time);

  00097	8d 85 50 fe ff
	ff		 lea	 eax, DWORD PTR _module_time$1[ebp]
  0009d	50		 push	 eax
  0009e	e8 00 00 00 00	 call	 __ctime64
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp

; 59   : 		fprintf(fException, "Time Stamp: 0x%08x - %s\n", module_time, ctime(&module_time));

  000a3	50		 push	 eax
  000a4	ff b5 54 fe ff
	ff		 push	 DWORD PTR _module_time$1[ebp+4]
  000aa	ff b5 50 fe ff
	ff		 push	 DWORD PTR _module_time$1[ebp]
  000b0	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@GCEEGBIB@Time?5Stamp?3?50x?$CF08x?5?9?5?$CFs?6@
  000b5	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  000bb	e8 00 00 00 00	 call	 _fprintf

; 60   : 		fprintf(fException, "\n");

  000c0	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6@
  000c5	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  000cb	e8 00 00 00 00	 call	 _fprintf

; 61   : 		fprintf(fException, "Exception Type: 0x%08x\n", pExceptionInfo->ExceptionRecord->ExceptionCode);

  000d0	8b 03		 mov	 eax, DWORD PTR [ebx]
  000d2	ff 30		 push	 DWORD PTR [eax]
  000d4	68 00 00 00 00	 push	 OFFSET ??_C@_0BI@KGPMOIII@Exception?5Type?3?50x?$CF08x?6@
  000d9	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  000df	e8 00 00 00 00	 call	 _fprintf

; 62   : 		fprintf(fException, "\n");

  000e4	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6@
  000e9	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  000ef	e8 00 00 00 00	 call	 _fprintf

; 63   : 
; 64   : 		/*
; 65   : 		{
; 66   : 			__idx+=sprintf(__msg+__idx,"Module Name: %s\n", module_name);
; 67   : 			__idx+=sprintf(__msg+__idx, "Time Stamp: 0x%08x - %s\n", module_time, ctime(&module_time));
; 68   : 			__idx+=sprintf(__msg+__idx, "\n");
; 69   : 			__idx+=sprintf(__msg+__idx, "Exception Type: 0x%08x\n", pExceptionInfo->ExceptionRecord->ExceptionCode);
; 70   : 			__idx+=sprintf(__msg+__idx, "\n");
; 71   : 		}
; 72   : 		*/
; 73   : 		
; 74   : 		CONTEXT&	context		= *pExceptionInfo->ContextRecord;

  000f4	8b 5b 04	 mov	 ebx, DWORD PTR [ebx+4]
  000f7	83 c4 40	 add	 esp, 64			; 00000040H

; 75   : 		
; 76   : 		fprintf(fException, "eax: 0x%08x\tebx: 0x%08x\n", context.Eax, context.Ebx);

  000fa	ff b3 a4 00 00
	00		 push	 DWORD PTR [ebx+164]
  00100	ff b3 b0 00 00
	00		 push	 DWORD PTR [ebx+176]
  00106	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@IEACADHK@eax?3?50x?$CF08x?7ebx?3?50x?$CF08x?6@
  0010b	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00111	e8 00 00 00 00	 call	 _fprintf

; 77   : 		fprintf(fException, "ecx: 0x%08x\tedx: 0x%08x\n", context.Ecx, context.Edx);

  00116	ff b3 a8 00 00
	00		 push	 DWORD PTR [ebx+168]
  0011c	ff b3 ac 00 00
	00		 push	 DWORD PTR [ebx+172]
  00122	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@LCAEGKJF@ecx?3?50x?$CF08x?7edx?3?50x?$CF08x?6@
  00127	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  0012d	e8 00 00 00 00	 call	 _fprintf

; 78   : 		fprintf(fException, "esi: 0x%08x\tedi: 0x%08x\n", context.Esi, context.Edi);

  00132	ff b3 9c 00 00
	00		 push	 DWORD PTR [ebx+156]
  00138	ff b3 a0 00 00
	00		 push	 DWORD PTR [ebx+160]
  0013e	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@DIBGGCDL@esi?3?50x?$CF08x?7edi?3?50x?$CF08x?6@
  00143	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00149	e8 00 00 00 00	 call	 _fprintf

; 79   : 		fprintf(fException, "ebp: 0x%08x\tesp: 0x%08x\n", context.Ebp, context.Esp);

  0014e	ff b3 c4 00 00
	00		 push	 DWORD PTR [ebx+196]
  00154	ff b3 b4 00 00
	00		 push	 DWORD PTR [ebx+180]
  0015a	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@PBNLKJKC@ebp?3?50x?$CF08x?7esp?3?50x?$CF08x?6@
  0015f	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00165	e8 00 00 00 00	 call	 _fprintf
  0016a	83 c4 40	 add	 esp, 64			; 00000040H

; 80   : 		fprintf(fException, "\n");

  0016d	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6@
  00172	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00178	e8 00 00 00 00	 call	 _fprintf

; 81   : 		/*
; 82   : 		{
; 83   : 			__idx+=sprintf(__msg+__idx, "eax: 0x%08x\tebx: 0x%08x\n", context.Eax, context.Ebx);
; 84   : 			__idx+=sprintf(__msg+__idx, "ecx: 0x%08x\tedx: 0x%08x\n", context.Ecx, context.Edx);
; 85   : 			__idx+=sprintf(__msg+__idx, "esi: 0x%08x\tedi: 0x%08x\n", context.Esi, context.Edi);
; 86   : 			__idx+=sprintf(__msg+__idx, "ebp: 0x%08x\tesp: 0x%08x\n", context.Ebp, context.Esp);
; 87   : 			__idx+=sprintf(__msg+__idx, "\n");
; 88   : 		}
; 89   : 		*/
; 90   : 		
; 91   : 		STACKFRAME stackFrame = {0,};

  0017d	68 a0 00 00 00	 push	 160			; 000000a0H
  00182	8d 85 5c fe ff
	ff		 lea	 eax, DWORD PTR _stackFrame$2[ebp+4]
  00188	6a 00		 push	 0
  0018a	50		 push	 eax
  0018b	e8 00 00 00 00	 call	 _memset

; 92   : 		stackFrame.AddrPC.Offset	= context.Eip;

  00190	8b 8b b8 00 00
	00		 mov	 ecx, DWORD PTR [ebx+184]
  00196	83 c4 14	 add	 esp, 20			; 00000014H
  00199	89 8d 58 fe ff
	ff		 mov	 DWORD PTR _stackFrame$2[ebp], ecx

; 93   : 		stackFrame.AddrPC.Mode		= AddrModeFlat;
; 94   : 		stackFrame.AddrStack.Offset	= context.Esp;
; 95   : 		stackFrame.AddrStack.Mode	= AddrModeFlat;
; 96   : 		stackFrame.AddrFrame.Offset	= context.Ebp;
; 97   : 		stackFrame.AddrFrame.Mode	= AddrModeFlat;
; 98   : 		
; 99   : 		for (int i=0; i < 512 && stackFrame.AddrPC.Offset; ++i)

  0019f	33 f6		 xor	 esi, esi
  001a1	c7 85 60 fe ff
	ff 03 00 00 00	 mov	 DWORD PTR _stackFrame$2[ebp+8], 3
  001ab	8b 83 c4 00 00
	00		 mov	 eax, DWORD PTR [ebx+196]
  001b1	89 85 7c fe ff
	ff		 mov	 DWORD PTR _stackFrame$2[ebp+36], eax
  001b7	c7 85 84 fe ff
	ff 03 00 00 00	 mov	 DWORD PTR _stackFrame$2[ebp+44], 3
  001c1	8b 83 b4 00 00
	00		 mov	 eax, DWORD PTR [ebx+180]
  001c7	89 85 70 fe ff
	ff		 mov	 DWORD PTR _stackFrame$2[ebp+24], eax
  001cd	c7 85 78 fe ff
	ff 03 00 00 00	 mov	 DWORD PTR _stackFrame$2[ebp+32], 3
$LL4@EterExcept:
  001d7	85 c9		 test	 ecx, ecx
  001d9	74 76		 je	 SHORT $LN18@EterExcept

; 100  : 		{
; 101  : 			if (StackWalk(IMAGE_FILE_MACHINE_I386, hProcess, hThread, &stackFrame, &context, NULL, NULL, NULL, NULL) != FALSE)

  001db	6a 00		 push	 0
  001dd	6a 00		 push	 0
  001df	6a 00		 push	 0
  001e1	6a 00		 push	 0
  001e3	53		 push	 ebx
  001e4	8d 85 58 fe ff
	ff		 lea	 eax, DWORD PTR _stackFrame$2[ebp]
  001ea	50		 push	 eax
  001eb	ff b5 4c fe ff
	ff		 push	 DWORD PTR _hThread$1$[ebp]
  001f1	57		 push	 edi
  001f2	68 4c 01 00 00	 push	 332			; 0000014cH
  001f7	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__StackWalk@36
  001fd	85 c0		 test	 eax, eax
  001ff	74 50		 je	 SHORT $LN18@EterExcept

; 102  : 			{
; 103  : 				fprintf(fException, "0x%08x\t", stackFrame.AddrPC.Offset);

  00201	ff b5 58 fe ff
	ff		 push	 DWORD PTR _stackFrame$2[ebp]
  00207	68 00 00 00 00	 push	 OFFSET ??_C@_07IIGIJDEL@0x?$CF08x?7@
  0020c	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00212	e8 00 00 00 00	 call	 _fprintf
  00217	83 c4 0c	 add	 esp, 12			; 0000000cH

; 104  : 				//__idx+=sprintf(__msg+__idx, "0x%08x\t", stackFrame.AddrPC.Offset);
; 105  : 				EnumerateLoadedModules(hProcess, (PENUMLOADED_MODULES_CALLBACK) EnumerateLoadedModulesProc, &stackFrame.AddrPC.Offset);

  0021a	8d 85 58 fe ff
	ff		 lea	 eax, DWORD PTR _stackFrame$2[ebp]
  00220	50		 push	 eax
  00221	68 00 00 00 00	 push	 OFFSET ?EnumerateLoadedModulesProc@@YGHPBDKKPAX@Z ; EnumerateLoadedModulesProc
  00226	57		 push	 edi
  00227	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__EnumerateLoadedModules@12

; 106  : 				fprintf(fException, "\n");

  0022d	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6@
  00232	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00238	e8 00 00 00 00	 call	 _fprintf
  0023d	46		 inc	 esi
  0023e	83 c4 08	 add	 esp, 8
  00241	81 fe 00 02 00
	00		 cmp	 esi, 512		; 00000200H
  00247	7d 08		 jge	 SHORT $LN18@EterExcept

; 93   : 		stackFrame.AddrPC.Mode		= AddrModeFlat;
; 94   : 		stackFrame.AddrStack.Offset	= context.Esp;
; 95   : 		stackFrame.AddrStack.Mode	= AddrModeFlat;
; 96   : 		stackFrame.AddrFrame.Offset	= context.Ebp;
; 97   : 		stackFrame.AddrFrame.Mode	= AddrModeFlat;
; 98   : 		
; 99   : 		for (int i=0; i < 512 && stackFrame.AddrPC.Offset; ++i)

  00249	8b 8d 58 fe ff
	ff		 mov	 ecx, DWORD PTR _stackFrame$2[ebp]
  0024f	eb 86		 jmp	 SHORT $LL4@EterExcept
$LN18@EterExcept:

; 107  : 
; 108  : 				//__idx+=sprintf(__msg+__idx,  "\n");
; 109  : 			}
; 110  : 			else
; 111  : 			{
; 112  : 				break;
; 113  : 			}
; 114  : 		} 
; 115  : 		
; 116  : 		fprintf(fException, "\n");

  00251	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6@
  00256	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  0025c	e8 00 00 00 00	 call	 _fprintf

; 117  : 		//__idx+=sprintf(__msg+__idx, "\n");
; 118  : 		
; 119  : 		
; 120  : /*
; 121  : 		BYTE* stack = (BYTE*)(context.Esp);
; 122  : 		fprintf(fException, "stack %08x - %08x\n", context.Esp, context.Esp+1024);
; 123  : 		//__idx+=sprintf(__msg+__idx, "stack %08x - %08x\n", context.Esp, context.Esp+1024);
; 124  : 		
; 125  : 		for(i=0; i<16; ++i)
; 126  : 		{
; 127  : 			fprintf(fException, "%08X : ", context.Esp+i*16);
; 128  : 			//__idx+=sprintf(__msg+__idx, "%08X : ", context.Esp+i*16);
; 129  : 			for(int j=0; j<16; ++j)
; 130  : 			{
; 131  : 				fprintf(fException, "%02X ", stack[i*16+j]);
; 132  : 				//__idx+=sprintf(__msg+__idx, "%02X ", stack[i*16+j]);
; 133  : 			}
; 134  : 			fprintf(fException, "\n");
; 135  : 			//__idx+=sprintf(__msg+__idx, "\n");
; 136  : 		}
; 137  : 		fprintf(fException, "\n");
; 138  : 		//__idx+=sprintf(__msg+__idx, "\n");
; 139  : */
; 140  : 
; 141  : 		fflush(fException);

  00261	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00267	e8 00 00 00 00	 call	 _fflush

; 142  : 
; 143  : 		fclose(fException);

  0026c	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00272	e8 00 00 00 00	 call	 _fclose
  00277	83 c4 10	 add	 esp, 16			; 00000010H

; 144  : 		fException = NULL;

  0027a	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?fException@@3PAU_iobuf@@A, 0 ; fException

; 145  : 		
; 146  : 		//WinExec()
; 147  : 		/*CreateProcess("cmd.exe",NULL,NULL,NULL,FALSE,
; 148  : 			CREATE_NEW_PROCESS_GROUP|DETACHED_PROCESS,NULL,NULL,NULL,NULL);
; 149  : 		MessageBox(NULL,"게임 실행에 치명적인 문제가 발생하였습니다.\n게임을 종료하고 에러 로그를 남깁니다.\n에러 로그를 서버에 보내시겠습니까?","에러 발생!",MB_YESNO);*/
; 150  : 
; 151  : 		/*
; 152  : 		__l.BeginCompressInBuffer(__msg,__idx,__cmsg);
; 153  : 		if (__l.Compress())
; 154  : 		{
; 155  : 			//fprintf(fException,"Compress printing\n");
; 156  : 			// send this to server
; 157  : 			SOCKET s = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
; 158  : 			
; 159  : 			ioctlsocket(s,FIONBIO,0);
; 160  : 
; 161  : 			if (s==INVALID_SOCKET)
; 162  : 			{
; 163  : 				//fprintf(fException,"INVALID %X\n",WSAGetLastError());
; 164  : 			}
; 165  : 			
; 166  : 			sockaddr_in sa;
; 167  : 			sa.sin_family = AF_INET;
; 168  : 			sa.sin_port = htons(19294);
; 169  : 			sa.sin_addr.s_addr = inet_addr("147.46.127.42");
; 170  : 			if (connect(s,(sockaddr*)&sa,sizeof(sa)))
; 171  : 			{
; 172  : 				//fprintf(fException,"%X\n",WSAGetLastError());
; 173  : 			}
; 174  : 
; 175  : 			int total = 0;
; 176  : 			int ret=0;
; 177  : 			while(1)
; 178  : 			{
; 179  : 				//ret = send(s,(char*)__msg+total,__idx-total,0);
; 180  : 				ret = send(s,(char*)__l.GetBuffer()+total,__l.GetSize()-total,0);
; 181  : 				//fprintf(fException,"send %d\n",ret);
; 182  : 				if (ret<0)
; 183  : 				{
; 184  : 					//fprintf(fException,"%X\n",WSAGetLastError());
; 185  : 					break;
; 186  : 				}
; 187  : 				total+=ret;
; 188  : 				if (total>=__idx)
; 189  : 				//if (total>=__l.GetSize())
; 190  : 					break;
; 191  : 			}
; 192  : 			//__l.GetBuffer();
; 193  : 			Sleep(500);
; 194  : 			closesocket(s);
; 195  : 		}*/
; 196  : 
; 197  : 		WinExec("errorlog.exe",SW_SHOW);

  00284	6a 05		 push	 5
  00286	68 00 00 00 00	 push	 OFFSET ??_C@_0N@KMPLBGID@errorlog?4exe@
  0028b	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__WinExec@8

; 198  : 		
; 199  : 		
; 200  : 	}
; 201  : 	
; 202  : 	return EXCEPTION_EXECUTE_HANDLER;

  00291	5e		 pop	 esi
$LN15@EterExcept:

; 203  : }

  00292	8b 4d fc	 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  00295	b8 01 00 00 00	 mov	 eax, 1
  0029a	5f		 pop	 edi
  0029b	33 cd		 xor	 ecx, ebp
  0029d	5b		 pop	 ebx
  0029e	e8 00 00 00 00	 call	 @__security_check_cookie@4
  002a3	8b e5		 mov	 esp, ebp
  002a5	5d		 pop	 ebp
  002a6	c2 04 00	 ret	 4
?EterExceptionFilter@@YGJPAU_EXCEPTION_POINTERS@@@Z ENDP ; EterExceptionFilter
_TEXT	ENDS
; Function compile flags: /Ogtp
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp
;	COMDAT ?EnumerateLoadedModulesProc@@YGHPBDKKPAX@Z
_TEXT	SEGMENT
_ModuleName$ = 8					; size = 4
_ModuleBase$ = 12					; size = 4
_ModuleSize$ = 16					; size = 4
_UserContext$ = 20					; size = 4
?EnumerateLoadedModulesProc@@YGHPBDKKPAX@Z PROC		; EnumerateLoadedModulesProc, COMDAT

; 29   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 30   : 	DWORD offset = *((DWORD*)UserContext);

  00003	8b 45 14	 mov	 eax, DWORD PTR _UserContext$[ebp]

; 31   : 	
; 32   : 	if (offset >= ModuleBase && offset <= ModuleBase + ModuleSize)

  00006	8b 55 0c	 mov	 edx, DWORD PTR _ModuleBase$[ebp]
  00009	8b 08		 mov	 ecx, DWORD PTR [eax]
  0000b	3b ca		 cmp	 ecx, edx
  0000d	72 25		 jb	 SHORT $LN2@EnumerateL
  0000f	8b 45 10	 mov	 eax, DWORD PTR _ModuleSize$[ebp]
  00012	03 c2		 add	 eax, edx
  00014	3b c8		 cmp	 ecx, eax
  00016	77 1c		 ja	 SHORT $LN2@EnumerateL

; 33   : 	{
; 34   : 		fprintf(fException, "%s", ModuleName);

  00018	ff 75 08	 push	 DWORD PTR _ModuleName$[ebp]
  0001b	68 00 00 00 00	 push	 OFFSET ??_C@_02DKCKIIND@?$CFs@
  00020	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00026	e8 00 00 00 00	 call	 _fprintf
  0002b	83 c4 0c	 add	 esp, 12			; 0000000cH

; 35   : 		//__idx += sprintf(__msg+__idx, "%s", ModuleName);
; 36   : 		return FALSE;

  0002e	33 c0		 xor	 eax, eax

; 40   : }

  00030	5d		 pop	 ebp
  00031	c2 10 00	 ret	 16			; 00000010H
$LN2@EnumerateL:

; 37   : 	}
; 38   : 	else
; 39   : 		return TRUE;

  00034	b8 01 00 00 00	 mov	 eax, 1

; 40   : }

  00039	5d		 pop	 ebp
  0003a	c2 10 00	 ret	 16			; 00000010H
?EnumerateLoadedModulesProc@@YGHPBDKKPAX@Z ENDP		; EnumerateLoadedModulesProc
_TEXT	ENDS
; Function compile flags: /Ogtp
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\stdio.h
;	COMDAT _fprintf
_TEXT	SEGMENT
__Stream$ = 8						; size = 4
__Format$ = 12						; size = 4
_fprintf PROC						; COMDAT

; 835  :     {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 643  :         return __stdio_common_vfprintf(_CRT_INTERNAL_LOCAL_PRINTF_OPTIONS, _Stream, _Format, _Locale, _ArgList);

  00003	8d 45 10	 lea	 eax, DWORD PTR __Format$[ebp+4]
  00006	50		 push	 eax
  00007	6a 00		 push	 0
  00009	ff 75 0c	 push	 DWORD PTR __Format$[ebp]
  0000c	ff 75 08	 push	 DWORD PTR __Stream$[ebp]
  0000f	e8 00 00 00 00	 call	 ___local_stdio_printf_options
  00014	ff 70 04	 push	 DWORD PTR [eax+4]
  00017	ff 30		 push	 DWORD PTR [eax]
  00019	e8 00 00 00 00	 call	 ___stdio_common_vfprintf
  0001e	83 c4 18	 add	 esp, 24			; 00000018H

; 836  :         int _Result;
; 837  :         va_list _ArgList;
; 838  :         __crt_va_start(_ArgList, _Format);
; 839  :         _Result = _vfprintf_l(_Stream, _Format, NULL, _ArgList);
; 840  :         __crt_va_end(_ArgList);
; 841  :         return _Result;
; 842  :     }

  00021	5d		 pop	 ebp
  00022	c3		 ret	 0
_fprintf ENDP
_TEXT	ENDS
; Function compile flags: /Ogtp
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\corecrt_stdio_config.h
;	COMDAT ___local_stdio_printf_options
_TEXT	SEGMENT
___local_stdio_printf_options PROC			; COMDAT

; 87   :         static unsigned __int64 _OptionsStorage;
; 88   :         return &_OptionsStorage;

  00000	b8 00 00 00 00	 mov	 eax, OFFSET ?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA ; `__local_stdio_printf_options'::`2'::_OptionsStorage

; 89   :     }

  00005	c3		 ret	 0
___local_stdio_printf_options ENDP
_TEXT	ENDS
END
