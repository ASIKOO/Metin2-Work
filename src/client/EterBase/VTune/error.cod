; Listing generated by Microsoft (R) Optimizing Compiler Version 19.28.29335.0 

	TITLE	D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?fException@@3PAU_iobuf@@A			; fException
_BSS	SEGMENT
?fException@@3PAU_iobuf@@A DD 01H DUP (?)		; fException
_BSS	ENDS
PUBLIC	___local_stdio_printf_options
PUBLIC	_fprintf
PUBLIC	?EnumerateLoadedModulesProc@@YGHPBDKKPAX@Z	; EnumerateLoadedModulesProc
PUBLIC	?EterExceptionFilter@@YGJPAU_EXCEPTION_POINTERS@@@Z ; EterExceptionFilter
PUBLIC	?SetEterExceptionHandler@@YAXXZ			; SetEterExceptionHandler
PUBLIC	?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA ; `__local_stdio_printf_options'::`2'::_OptionsStorage
PUBLIC	??_C@_02DKCKIIND@?$CFs@				; `string'
PUBLIC	??_C@_02BKFDOEMK@wt@				; `string'
PUBLIC	??_C@_0N@FNIPCMMK@ErrorLog?4txt@		; `string'
PUBLIC	??_C@_0BB@MMHGDGEH@Module?5Name?3?5?$CFs?6@	; `string'
PUBLIC	??_C@_0BJ@GCEEGBIB@Time?5Stamp?3?50x?$CF08x?5?9?5?$CFs?6@ ; `string'
PUBLIC	??_C@_01EEMJAFIK@?6@				; `string'
PUBLIC	??_C@_0BI@KGPMOIII@Exception?5Type?3?50x?$CF08x?6@ ; `string'
PUBLIC	??_C@_0BJ@IEACADHK@eax?3?50x?$CF08x?7ebx?3?50x?$CF08x?6@ ; `string'
PUBLIC	??_C@_0BJ@LCAEGKJF@ecx?3?50x?$CF08x?7edx?3?50x?$CF08x?6@ ; `string'
PUBLIC	??_C@_0BJ@DIBGGCDL@esi?3?50x?$CF08x?7edi?3?50x?$CF08x?6@ ; `string'
PUBLIC	??_C@_0BJ@PBNLKJKC@ebp?3?50x?$CF08x?7esp?3?50x?$CF08x?6@ ; `string'
PUBLIC	??_C@_07IIGIJDEL@0x?$CF08x?7@			; `string'
PUBLIC	??_C@_0N@KMPLBGID@errorlog?4exe@		; `string'
EXTRN	__imp__SetUnhandledExceptionFilter@4:PROC
EXTRN	__imp__GetCurrentProcess@0:PROC
EXTRN	__imp__GetCurrentThread@0:PROC
EXTRN	__imp__GetModuleFileNameA@12:PROC
EXTRN	__imp__GetModuleHandleA@4:PROC
EXTRN	__imp__WinExec@8:PROC
EXTRN	_fclose:PROC
EXTRN	_fflush:PROC
EXTRN	_fopen:PROC
EXTRN	___stdio_common_vfprintf:PROC
EXTRN	__imp__StackWalk@36:PROC
EXTRN	__imp__GetTimestampForLoadedLibrary@4:PROC
EXTRN	__imp__EnumerateLoadedModules@12:PROC
EXTRN	__ctime64:PROC
EXTRN	@__security_check_cookie@4:PROC
EXTRN	_memset:PROC
EXTRN	___security_cookie:DWORD
;	COMDAT ?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA
_BSS	SEGMENT
?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA DQ 01H DUP (?) ; `__local_stdio_printf_options'::`2'::_OptionsStorage
_BSS	ENDS
;	COMDAT ??_C@_0N@KMPLBGID@errorlog?4exe@
CONST	SEGMENT
??_C@_0N@KMPLBGID@errorlog?4exe@ DB 'errorlog.exe', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_07IIGIJDEL@0x?$CF08x?7@
CONST	SEGMENT
??_C@_07IIGIJDEL@0x?$CF08x?7@ DB '0x%08x', 09H, 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@PBNLKJKC@ebp?3?50x?$CF08x?7esp?3?50x?$CF08x?6@
CONST	SEGMENT
??_C@_0BJ@PBNLKJKC@ebp?3?50x?$CF08x?7esp?3?50x?$CF08x?6@ DB 'ebp: 0x%08x', 09H
	DB	'esp: 0x%08x', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@DIBGGCDL@esi?3?50x?$CF08x?7edi?3?50x?$CF08x?6@
CONST	SEGMENT
??_C@_0BJ@DIBGGCDL@esi?3?50x?$CF08x?7edi?3?50x?$CF08x?6@ DB 'esi: 0x%08x', 09H
	DB	'edi: 0x%08x', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@LCAEGKJF@ecx?3?50x?$CF08x?7edx?3?50x?$CF08x?6@
CONST	SEGMENT
??_C@_0BJ@LCAEGKJF@ecx?3?50x?$CF08x?7edx?3?50x?$CF08x?6@ DB 'ecx: 0x%08x', 09H
	DB	'edx: 0x%08x', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@IEACADHK@eax?3?50x?$CF08x?7ebx?3?50x?$CF08x?6@
CONST	SEGMENT
??_C@_0BJ@IEACADHK@eax?3?50x?$CF08x?7ebx?3?50x?$CF08x?6@ DB 'eax: 0x%08x', 09H
	DB	'ebx: 0x%08x', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BI@KGPMOIII@Exception?5Type?3?50x?$CF08x?6@
CONST	SEGMENT
??_C@_0BI@KGPMOIII@Exception?5Type?3?50x?$CF08x?6@ DB 'Exception Type: 0x'
	DB	'%08x', 0aH, 00H				; `string'
CONST	ENDS
;	COMDAT ??_C@_01EEMJAFIK@?6@
CONST	SEGMENT
??_C@_01EEMJAFIK@?6@ DB 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BJ@GCEEGBIB@Time?5Stamp?3?50x?$CF08x?5?9?5?$CFs?6@
CONST	SEGMENT
??_C@_0BJ@GCEEGBIB@Time?5Stamp?3?50x?$CF08x?5?9?5?$CFs?6@ DB 'Time Stamp:'
	DB	' 0x%08x - %s', 0aH, 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_0BB@MMHGDGEH@Module?5Name?3?5?$CFs?6@
CONST	SEGMENT
??_C@_0BB@MMHGDGEH@Module?5Name?3?5?$CFs?6@ DB 'Module Name: %s', 0aH, 00H ; `string'
CONST	ENDS
;	COMDAT ??_C@_0N@FNIPCMMK@ErrorLog?4txt@
CONST	SEGMENT
??_C@_0N@FNIPCMMK@ErrorLog?4txt@ DB 'ErrorLog.txt', 00H	; `string'
CONST	ENDS
;	COMDAT ??_C@_02BKFDOEMK@wt@
CONST	SEGMENT
??_C@_02BKFDOEMK@wt@ DB 'wt', 00H			; `string'
CONST	ENDS
;	COMDAT ??_C@_02DKCKIIND@?$CFs@
CONST	SEGMENT
??_C@_02DKCKIIND@?$CFs@ DB '%s', 00H			; `string'
CONST	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp
;	COMDAT ?SetEterExceptionHandler@@YAXXZ
_TEXT	SEGMENT
?SetEterExceptionHandler@@YAXXZ PROC			; SetEterExceptionHandler, COMDAT

; 206  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 207  : 	SetUnhandledExceptionFilter(EterExceptionFilter);

  00003	68 00 00 00 00	 push	 OFFSET ?EterExceptionFilter@@YGJPAU_EXCEPTION_POINTERS@@@Z ; EterExceptionFilter
  00008	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__SetUnhandledExceptionFilter@4

; 208  : }

  0000e	5d		 pop	 ebp
  0000f	c3		 ret	 0
?SetEterExceptionHandler@@YAXXZ ENDP			; SetEterExceptionHandler
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\time.h
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp
;	COMDAT ?EterExceptionFilter@@YGJPAU_EXCEPTION_POINTERS@@@Z
_TEXT	SEGMENT
_hThread$ = -128					; size = 4
$T1 = -124						; size = 4
_module_time$2 = -120					; size = 8
_hProcess$ = -112					; size = 4
_hModule$3 = -108					; size = 4
_i$4 = -104						; size = 4
_context$5 = -100					; size = 4
_stackFrame$6 = -96					; size = 164
_module_name$7 = 68					; size = 256
__$ArrayPad$ = 324					; size = 4
_pExceptionInfo$ = 336					; size = 4
?EterExceptionFilter@@YGJPAU_EXCEPTION_POINTERS@@@Z PROC ; EterExceptionFilter, COMDAT

; 43   : {

  00000	55		 push	 ebp
  00001	8d ac 24 b8 fe
	ff ff		 lea	 ebp, DWORD PTR [esp-328]
  00008	81 ec c8 01 00
	00		 sub	 esp, 456		; 000001c8H
  0000e	a1 00 00 00 00	 mov	 eax, DWORD PTR ___security_cookie
  00013	33 c5		 xor	 eax, ebp
  00015	89 85 44 01 00
	00		 mov	 DWORD PTR __$ArrayPad$[ebp], eax

; 44   : 	HANDLE		hProcess	= GetCurrentProcess();

  0001b	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetCurrentProcess@0
  00021	89 45 90	 mov	 DWORD PTR _hProcess$[ebp], eax

; 45   : 	HANDLE		hThread		= GetCurrentThread();

  00024	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetCurrentThread@0
  0002a	89 45 80	 mov	 DWORD PTR _hThread$[ebp], eax

; 46   : 	
; 47   : 	fException = fopen("ErrorLog.txt", "wt");

  0002d	68 00 00 00 00	 push	 OFFSET ??_C@_02BKFDOEMK@wt@
  00032	68 00 00 00 00	 push	 OFFSET ??_C@_0N@FNIPCMMK@ErrorLog?4txt@
  00037	e8 00 00 00 00	 call	 _fopen
  0003c	59		 pop	 ecx
  0003d	59		 pop	 ecx
  0003e	a3 00 00 00 00	 mov	 DWORD PTR ?fException@@3PAU_iobuf@@A, eax ; fException

; 48   : 	if (fException)

  00043	83 3d 00 00 00
	00 00		 cmp	 DWORD PTR ?fException@@3PAU_iobuf@@A, 0 ; fException
  0004a	0f 84 6f 02 00
	00		 je	 $LN5@EterExcept

; 49   : 	{
; 50   : 		char module_name[256];
; 51   : 		time_t module_time;
; 52   : 		
; 53   : 		HMODULE hModule = GetModuleHandle(NULL);

  00050	6a 00		 push	 0
  00052	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetModuleHandleA@4
  00058	89 45 94	 mov	 DWORD PTR _hModule$3[ebp], eax

; 54   : 		
; 55   : 		GetModuleFileName(hModule, module_name, sizeof(module_name));

  0005b	68 00 01 00 00	 push	 256			; 00000100H
  00060	8d 45 44	 lea	 eax, DWORD PTR _module_name$7[ebp]
  00063	50		 push	 eax
  00064	ff 75 94	 push	 DWORD PTR _hModule$3[ebp]
  00067	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetModuleFileNameA@12

; 56   : 		module_time = (time_t)GetTimestampForLoadedLibrary(hModule);

  0006d	ff 75 94	 push	 DWORD PTR _hModule$3[ebp]
  00070	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GetTimestampForLoadedLibrary@4
  00076	33 c9		 xor	 ecx, ecx
  00078	89 45 88	 mov	 DWORD PTR _module_time$2[ebp], eax
  0007b	89 4d 8c	 mov	 DWORD PTR _module_time$2[ebp+4], ecx

; 57   : 		
; 58   : 		fprintf(fException, "Module Name: %s\n", module_name);

  0007e	8d 45 44	 lea	 eax, DWORD PTR _module_name$7[ebp]
  00081	50		 push	 eax
  00082	68 00 00 00 00	 push	 OFFSET ??_C@_0BB@MMHGDGEH@Module?5Name?3?5?$CFs?6@
  00087	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  0008d	e8 00 00 00 00	 call	 _fprintf
  00092	83 c4 0c	 add	 esp, 12			; 0000000cH
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\time.h

; 482  :             return _ctime64(_Time);

  00095	8d 45 88	 lea	 eax, DWORD PTR _module_time$2[ebp]
  00098	50		 push	 eax
  00099	e8 00 00 00 00	 call	 __ctime64
  0009e	59		 pop	 ecx
  0009f	89 45 84	 mov	 DWORD PTR $T1[ebp], eax
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp

; 59   : 		fprintf(fException, "Time Stamp: 0x%08x - %s\n", module_time, ctime(&module_time));

  000a2	ff 75 84	 push	 DWORD PTR $T1[ebp]
  000a5	ff 75 8c	 push	 DWORD PTR _module_time$2[ebp+4]
  000a8	ff 75 88	 push	 DWORD PTR _module_time$2[ebp]
  000ab	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@GCEEGBIB@Time?5Stamp?3?50x?$CF08x?5?9?5?$CFs?6@
  000b0	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  000b6	e8 00 00 00 00	 call	 _fprintf
  000bb	83 c4 14	 add	 esp, 20			; 00000014H

; 60   : 		fprintf(fException, "\n");

  000be	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6@
  000c3	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  000c9	e8 00 00 00 00	 call	 _fprintf
  000ce	59		 pop	 ecx
  000cf	59		 pop	 ecx

; 61   : 		fprintf(fException, "Exception Type: 0x%08x\n", pExceptionInfo->ExceptionRecord->ExceptionCode);

  000d0	8b 85 50 01 00
	00		 mov	 eax, DWORD PTR _pExceptionInfo$[ebp]
  000d6	8b 00		 mov	 eax, DWORD PTR [eax]
  000d8	ff 30		 push	 DWORD PTR [eax]
  000da	68 00 00 00 00	 push	 OFFSET ??_C@_0BI@KGPMOIII@Exception?5Type?3?50x?$CF08x?6@
  000df	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  000e5	e8 00 00 00 00	 call	 _fprintf
  000ea	83 c4 0c	 add	 esp, 12			; 0000000cH

; 62   : 		fprintf(fException, "\n");

  000ed	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6@
  000f2	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  000f8	e8 00 00 00 00	 call	 _fprintf
  000fd	59		 pop	 ecx
  000fe	59		 pop	 ecx

; 63   : 
; 64   : 		/*
; 65   : 		{
; 66   : 			__idx+=sprintf(__msg+__idx,"Module Name: %s\n", module_name);
; 67   : 			__idx+=sprintf(__msg+__idx, "Time Stamp: 0x%08x - %s\n", module_time, ctime(&module_time));
; 68   : 			__idx+=sprintf(__msg+__idx, "\n");
; 69   : 			__idx+=sprintf(__msg+__idx, "Exception Type: 0x%08x\n", pExceptionInfo->ExceptionRecord->ExceptionCode);
; 70   : 			__idx+=sprintf(__msg+__idx, "\n");
; 71   : 		}
; 72   : 		*/
; 73   : 		
; 74   : 		CONTEXT&	context		= *pExceptionInfo->ContextRecord;

  000ff	8b 85 50 01 00
	00		 mov	 eax, DWORD PTR _pExceptionInfo$[ebp]
  00105	8b 40 04	 mov	 eax, DWORD PTR [eax+4]
  00108	89 45 9c	 mov	 DWORD PTR _context$5[ebp], eax

; 75   : 		
; 76   : 		fprintf(fException, "eax: 0x%08x\tebx: 0x%08x\n", context.Eax, context.Ebx);

  0010b	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  0010e	ff b0 a4 00 00
	00		 push	 DWORD PTR [eax+164]
  00114	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  00117	ff b0 b0 00 00
	00		 push	 DWORD PTR [eax+176]
  0011d	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@IEACADHK@eax?3?50x?$CF08x?7ebx?3?50x?$CF08x?6@
  00122	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00128	e8 00 00 00 00	 call	 _fprintf
  0012d	83 c4 10	 add	 esp, 16			; 00000010H

; 77   : 		fprintf(fException, "ecx: 0x%08x\tedx: 0x%08x\n", context.Ecx, context.Edx);

  00130	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  00133	ff b0 a8 00 00
	00		 push	 DWORD PTR [eax+168]
  00139	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  0013c	ff b0 ac 00 00
	00		 push	 DWORD PTR [eax+172]
  00142	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@LCAEGKJF@ecx?3?50x?$CF08x?7edx?3?50x?$CF08x?6@
  00147	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  0014d	e8 00 00 00 00	 call	 _fprintf
  00152	83 c4 10	 add	 esp, 16			; 00000010H

; 78   : 		fprintf(fException, "esi: 0x%08x\tedi: 0x%08x\n", context.Esi, context.Edi);

  00155	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  00158	ff b0 9c 00 00
	00		 push	 DWORD PTR [eax+156]
  0015e	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  00161	ff b0 a0 00 00
	00		 push	 DWORD PTR [eax+160]
  00167	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@DIBGGCDL@esi?3?50x?$CF08x?7edi?3?50x?$CF08x?6@
  0016c	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00172	e8 00 00 00 00	 call	 _fprintf
  00177	83 c4 10	 add	 esp, 16			; 00000010H

; 79   : 		fprintf(fException, "ebp: 0x%08x\tesp: 0x%08x\n", context.Ebp, context.Esp);

  0017a	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  0017d	ff b0 c4 00 00
	00		 push	 DWORD PTR [eax+196]
  00183	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  00186	ff b0 b4 00 00
	00		 push	 DWORD PTR [eax+180]
  0018c	68 00 00 00 00	 push	 OFFSET ??_C@_0BJ@PBNLKJKC@ebp?3?50x?$CF08x?7esp?3?50x?$CF08x?6@
  00191	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00197	e8 00 00 00 00	 call	 _fprintf
  0019c	83 c4 10	 add	 esp, 16			; 00000010H

; 80   : 		fprintf(fException, "\n");

  0019f	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6@
  001a4	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  001aa	e8 00 00 00 00	 call	 _fprintf
  001af	59		 pop	 ecx
  001b0	59		 pop	 ecx

; 81   : 		/*
; 82   : 		{
; 83   : 			__idx+=sprintf(__msg+__idx, "eax: 0x%08x\tebx: 0x%08x\n", context.Eax, context.Ebx);
; 84   : 			__idx+=sprintf(__msg+__idx, "ecx: 0x%08x\tedx: 0x%08x\n", context.Ecx, context.Edx);
; 85   : 			__idx+=sprintf(__msg+__idx, "esi: 0x%08x\tedi: 0x%08x\n", context.Esi, context.Edi);
; 86   : 			__idx+=sprintf(__msg+__idx, "ebp: 0x%08x\tesp: 0x%08x\n", context.Ebp, context.Esp);
; 87   : 			__idx+=sprintf(__msg+__idx, "\n");
; 88   : 		}
; 89   : 		*/
; 90   : 		
; 91   : 		STACKFRAME stackFrame = {0,};

  001b1	83 65 a0 00	 and	 DWORD PTR _stackFrame$6[ebp], 0
  001b5	68 a0 00 00 00	 push	 160			; 000000a0H
  001ba	6a 00		 push	 0
  001bc	8d 45 a4	 lea	 eax, DWORD PTR _stackFrame$6[ebp+4]
  001bf	50		 push	 eax
  001c0	e8 00 00 00 00	 call	 _memset
  001c5	83 c4 0c	 add	 esp, 12			; 0000000cH

; 92   : 		stackFrame.AddrPC.Offset	= context.Eip;

  001c8	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  001cb	8b 80 b8 00 00
	00		 mov	 eax, DWORD PTR [eax+184]
  001d1	89 45 a0	 mov	 DWORD PTR _stackFrame$6[ebp], eax

; 93   : 		stackFrame.AddrPC.Mode		= AddrModeFlat;

  001d4	c7 45 a8 03 00
	00 00		 mov	 DWORD PTR _stackFrame$6[ebp+8], 3

; 94   : 		stackFrame.AddrStack.Offset	= context.Esp;

  001db	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  001de	8b 80 c4 00 00
	00		 mov	 eax, DWORD PTR [eax+196]
  001e4	89 45 c4	 mov	 DWORD PTR _stackFrame$6[ebp+36], eax

; 95   : 		stackFrame.AddrStack.Mode	= AddrModeFlat;

  001e7	c7 45 cc 03 00
	00 00		 mov	 DWORD PTR _stackFrame$6[ebp+44], 3

; 96   : 		stackFrame.AddrFrame.Offset	= context.Ebp;

  001ee	8b 45 9c	 mov	 eax, DWORD PTR _context$5[ebp]
  001f1	8b 80 b4 00 00
	00		 mov	 eax, DWORD PTR [eax+180]
  001f7	89 45 b8	 mov	 DWORD PTR _stackFrame$6[ebp+24], eax

; 97   : 		stackFrame.AddrFrame.Mode	= AddrModeFlat;

  001fa	c7 45 c0 03 00
	00 00		 mov	 DWORD PTR _stackFrame$6[ebp+32], 3

; 98   : 		
; 99   : 		for (int i=0; i < 512 && stackFrame.AddrPC.Offset; ++i)

  00201	83 65 98 00	 and	 DWORD PTR _i$4[ebp], 0
  00205	eb 07		 jmp	 SHORT $LN4@EterExcept
$LN2@EterExcept:
  00207	8b 45 98	 mov	 eax, DWORD PTR _i$4[ebp]
  0020a	40		 inc	 eax
  0020b	89 45 98	 mov	 DWORD PTR _i$4[ebp], eax
$LN4@EterExcept:
  0020e	81 7d 98 00 02
	00 00		 cmp	 DWORD PTR _i$4[ebp], 512 ; 00000200H
  00215	7d 6a		 jge	 SHORT $LN3@EterExcept
  00217	83 7d a0 00	 cmp	 DWORD PTR _stackFrame$6[ebp], 0
  0021b	74 64		 je	 SHORT $LN3@EterExcept

; 100  : 		{
; 101  : 			if (StackWalk(IMAGE_FILE_MACHINE_I386, hProcess, hThread, &stackFrame, &context, NULL, NULL, NULL, NULL) != FALSE)

  0021d	6a 00		 push	 0
  0021f	6a 00		 push	 0
  00221	6a 00		 push	 0
  00223	6a 00		 push	 0
  00225	ff 75 9c	 push	 DWORD PTR _context$5[ebp]
  00228	8d 45 a0	 lea	 eax, DWORD PTR _stackFrame$6[ebp]
  0022b	50		 push	 eax
  0022c	ff 75 80	 push	 DWORD PTR _hThread$[ebp]
  0022f	ff 75 90	 push	 DWORD PTR _hProcess$[ebp]
  00232	68 4c 01 00 00	 push	 332			; 0000014cH
  00237	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__StackWalk@36
  0023d	85 c0		 test	 eax, eax
  0023f	74 3c		 je	 SHORT $LN6@EterExcept

; 102  : 			{
; 103  : 				fprintf(fException, "0x%08x\t", stackFrame.AddrPC.Offset);

  00241	ff 75 a0	 push	 DWORD PTR _stackFrame$6[ebp]
  00244	68 00 00 00 00	 push	 OFFSET ??_C@_07IIGIJDEL@0x?$CF08x?7@
  00249	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  0024f	e8 00 00 00 00	 call	 _fprintf
  00254	83 c4 0c	 add	 esp, 12			; 0000000cH

; 104  : 				//__idx+=sprintf(__msg+__idx, "0x%08x\t", stackFrame.AddrPC.Offset);
; 105  : 				EnumerateLoadedModules(hProcess, (PENUMLOADED_MODULES_CALLBACK) EnumerateLoadedModulesProc, &stackFrame.AddrPC.Offset);

  00257	8d 45 a0	 lea	 eax, DWORD PTR _stackFrame$6[ebp]
  0025a	50		 push	 eax
  0025b	68 00 00 00 00	 push	 OFFSET ?EnumerateLoadedModulesProc@@YGHPBDKKPAX@Z ; EnumerateLoadedModulesProc
  00260	ff 75 90	 push	 DWORD PTR _hProcess$[ebp]
  00263	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__EnumerateLoadedModules@12

; 106  : 				fprintf(fException, "\n");

  00269	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6@
  0026e	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00274	e8 00 00 00 00	 call	 _fprintf
  00279	59		 pop	 ecx
  0027a	59		 pop	 ecx

; 107  : 
; 108  : 				//__idx+=sprintf(__msg+__idx,  "\n");
; 109  : 			}

  0027b	eb 02		 jmp	 SHORT $LN7@EterExcept
$LN6@EterExcept:

; 110  : 			else
; 111  : 			{
; 112  : 				break;

  0027d	eb 02		 jmp	 SHORT $LN3@EterExcept
$LN7@EterExcept:

; 113  : 			}
; 114  : 		} 

  0027f	eb 86		 jmp	 SHORT $LN2@EterExcept
$LN3@EterExcept:

; 115  : 		
; 116  : 		fprintf(fException, "\n");

  00281	68 00 00 00 00	 push	 OFFSET ??_C@_01EEMJAFIK@?6@
  00286	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  0028c	e8 00 00 00 00	 call	 _fprintf
  00291	59		 pop	 ecx
  00292	59		 pop	 ecx

; 117  : 		//__idx+=sprintf(__msg+__idx, "\n");
; 118  : 		
; 119  : 		
; 120  : /*
; 121  : 		BYTE* stack = (BYTE*)(context.Esp);
; 122  : 		fprintf(fException, "stack %08x - %08x\n", context.Esp, context.Esp+1024);
; 123  : 		//__idx+=sprintf(__msg+__idx, "stack %08x - %08x\n", context.Esp, context.Esp+1024);
; 124  : 		
; 125  : 		for(i=0; i<16; ++i)
; 126  : 		{
; 127  : 			fprintf(fException, "%08X : ", context.Esp+i*16);
; 128  : 			//__idx+=sprintf(__msg+__idx, "%08X : ", context.Esp+i*16);
; 129  : 			for(int j=0; j<16; ++j)
; 130  : 			{
; 131  : 				fprintf(fException, "%02X ", stack[i*16+j]);
; 132  : 				//__idx+=sprintf(__msg+__idx, "%02X ", stack[i*16+j]);
; 133  : 			}
; 134  : 			fprintf(fException, "\n");
; 135  : 			//__idx+=sprintf(__msg+__idx, "\n");
; 136  : 		}
; 137  : 		fprintf(fException, "\n");
; 138  : 		//__idx+=sprintf(__msg+__idx, "\n");
; 139  : */
; 140  : 
; 141  : 		fflush(fException);

  00293	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  00299	e8 00 00 00 00	 call	 _fflush
  0029e	59		 pop	 ecx

; 142  : 
; 143  : 		fclose(fException);

  0029f	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  002a5	e8 00 00 00 00	 call	 _fclose
  002aa	59		 pop	 ecx

; 144  : 		fException = NULL;

  002ab	83 25 00 00 00
	00 00		 and	 DWORD PTR ?fException@@3PAU_iobuf@@A, 0 ; fException

; 145  : 		
; 146  : 		//WinExec()
; 147  : 		/*CreateProcess("cmd.exe",NULL,NULL,NULL,FALSE,
; 148  : 			CREATE_NEW_PROCESS_GROUP|DETACHED_PROCESS,NULL,NULL,NULL,NULL);
; 149  : 		MessageBox(NULL,"게임 실행에 치명적인 문제가 발생하였습니다.\n게임을 종료하고 에러 로그를 남깁니다.\n에러 로그를 서버에 보내시겠습니까?","에러 발생!",MB_YESNO);*/
; 150  : 
; 151  : 		/*
; 152  : 		__l.BeginCompressInBuffer(__msg,__idx,__cmsg);
; 153  : 		if (__l.Compress())
; 154  : 		{
; 155  : 			//fprintf(fException,"Compress printing\n");
; 156  : 			// send this to server
; 157  : 			SOCKET s = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
; 158  : 			
; 159  : 			ioctlsocket(s,FIONBIO,0);
; 160  : 
; 161  : 			if (s==INVALID_SOCKET)
; 162  : 			{
; 163  : 				//fprintf(fException,"INVALID %X\n",WSAGetLastError());
; 164  : 			}
; 165  : 			
; 166  : 			sockaddr_in sa;
; 167  : 			sa.sin_family = AF_INET;
; 168  : 			sa.sin_port = htons(19294);
; 169  : 			sa.sin_addr.s_addr = inet_addr("147.46.127.42");
; 170  : 			if (connect(s,(sockaddr*)&sa,sizeof(sa)))
; 171  : 			{
; 172  : 				//fprintf(fException,"%X\n",WSAGetLastError());
; 173  : 			}
; 174  : 
; 175  : 			int total = 0;
; 176  : 			int ret=0;
; 177  : 			while(1)
; 178  : 			{
; 179  : 				//ret = send(s,(char*)__msg+total,__idx-total,0);
; 180  : 				ret = send(s,(char*)__l.GetBuffer()+total,__l.GetSize()-total,0);
; 181  : 				//fprintf(fException,"send %d\n",ret);
; 182  : 				if (ret<0)
; 183  : 				{
; 184  : 					//fprintf(fException,"%X\n",WSAGetLastError());
; 185  : 					break;
; 186  : 				}
; 187  : 				total+=ret;
; 188  : 				if (total>=__idx)
; 189  : 				//if (total>=__l.GetSize())
; 190  : 					break;
; 191  : 			}
; 192  : 			//__l.GetBuffer();
; 193  : 			Sleep(500);
; 194  : 			closesocket(s);
; 195  : 		}*/
; 196  : 
; 197  : 		WinExec("errorlog.exe",SW_SHOW);

  002b2	6a 05		 push	 5
  002b4	68 00 00 00 00	 push	 OFFSET ??_C@_0N@KMPLBGID@errorlog?4exe@
  002b9	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__WinExec@8
$LN5@EterExcept:

; 198  : 		
; 199  : 		
; 200  : 	}
; 201  : 	
; 202  : 	return EXCEPTION_EXECUTE_HANDLER;

  002bf	33 c0		 xor	 eax, eax
  002c1	40		 inc	 eax

; 203  : }

  002c2	8b 8d 44 01 00
	00		 mov	 ecx, DWORD PTR __$ArrayPad$[ebp]
  002c8	33 cd		 xor	 ecx, ebp
  002ca	e8 00 00 00 00	 call	 @__security_check_cookie@4
  002cf	81 c5 48 01 00
	00		 add	 ebp, 328		; 00000148H
  002d5	c9		 leave
  002d6	c2 04 00	 ret	 4
?EterExceptionFilter@@YGJPAU_EXCEPTION_POINTERS@@@Z ENDP ; EterExceptionFilter
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\error.cpp
;	COMDAT ?EnumerateLoadedModulesProc@@YGHPBDKKPAX@Z
_TEXT	SEGMENT
_offset$ = -4						; size = 4
_ModuleName$ = 8					; size = 4
_ModuleBase$ = 12					; size = 4
_ModuleSize$ = 16					; size = 4
_UserContext$ = 20					; size = 4
?EnumerateLoadedModulesProc@@YGHPBDKKPAX@Z PROC		; EnumerateLoadedModulesProc, COMDAT

; 29   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx

; 30   : 	DWORD offset = *((DWORD*)UserContext);

  00004	8b 45 14	 mov	 eax, DWORD PTR _UserContext$[ebp]
  00007	8b 00		 mov	 eax, DWORD PTR [eax]
  00009	89 45 fc	 mov	 DWORD PTR _offset$[ebp], eax

; 31   : 	
; 32   : 	if (offset >= ModuleBase && offset <= ModuleBase + ModuleSize)

  0000c	8b 45 fc	 mov	 eax, DWORD PTR _offset$[ebp]
  0000f	3b 45 0c	 cmp	 eax, DWORD PTR _ModuleBase$[ebp]
  00012	72 27		 jb	 SHORT $LN2@EnumerateL
  00014	8b 45 0c	 mov	 eax, DWORD PTR _ModuleBase$[ebp]
  00017	03 45 10	 add	 eax, DWORD PTR _ModuleSize$[ebp]
  0001a	39 45 fc	 cmp	 DWORD PTR _offset$[ebp], eax
  0001d	77 1c		 ja	 SHORT $LN2@EnumerateL

; 33   : 	{
; 34   : 		fprintf(fException, "%s", ModuleName);

  0001f	ff 75 08	 push	 DWORD PTR _ModuleName$[ebp]
  00022	68 00 00 00 00	 push	 OFFSET ??_C@_02DKCKIIND@?$CFs@
  00027	ff 35 00 00 00
	00		 push	 DWORD PTR ?fException@@3PAU_iobuf@@A ; fException
  0002d	e8 00 00 00 00	 call	 _fprintf
  00032	83 c4 0c	 add	 esp, 12			; 0000000cH

; 35   : 		//__idx += sprintf(__msg+__idx, "%s", ModuleName);
; 36   : 		return FALSE;

  00035	33 c0		 xor	 eax, eax
  00037	eb 05		 jmp	 SHORT $LN1@EnumerateL

; 37   : 	}

  00039	eb 03		 jmp	 SHORT $LN1@EnumerateL
$LN2@EnumerateL:

; 38   : 	else
; 39   : 		return TRUE;

  0003b	33 c0		 xor	 eax, eax
  0003d	40		 inc	 eax
$LN1@EnumerateL:

; 40   : }

  0003e	c9		 leave
  0003f	c2 10 00	 ret	 16			; 00000010H
?EnumerateLoadedModulesProc@@YGHPBDKKPAX@Z ENDP		; EnumerateLoadedModulesProc
_TEXT	ENDS
; Function compile flags: /Odspy
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\stdio.h
;	COMDAT _fprintf
_TEXT	SEGMENT
__Result$ = -12						; size = 4
__Format$ = -8						; size = 4
__ArgList$ = -4						; size = 4
__Stream$ = 8						; size = 4
__Format$ = 12						; size = 4
_fprintf PROC						; COMDAT

; 835  :     {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 0c	 sub	 esp, 12			; 0000000cH

; 836  :         int _Result;
; 837  :         va_list _ArgList;
; 838  :         __crt_va_start(_ArgList, _Format);

  00006	8d 45 10	 lea	 eax, DWORD PTR __Format$[ebp+4]
  00009	89 45 fc	 mov	 DWORD PTR __ArgList$[ebp], eax

; 839  :         _Result = _vfprintf_l(_Stream, _Format, NULL, _ArgList);

  0000c	8b 45 0c	 mov	 eax, DWORD PTR __Format$[ebp]
  0000f	89 45 f8	 mov	 DWORD PTR __Format$[ebp], eax

; 643  :         return __stdio_common_vfprintf(_CRT_INTERNAL_LOCAL_PRINTF_OPTIONS, _Stream, _Format, _Locale, _ArgList);

  00012	ff 75 fc	 push	 DWORD PTR __ArgList$[ebp]
  00015	6a 00		 push	 0
  00017	ff 75 f8	 push	 DWORD PTR __Format$[ebp]
  0001a	ff 75 08	 push	 DWORD PTR __Stream$[ebp]
  0001d	e8 00 00 00 00	 call	 ___local_stdio_printf_options
  00022	ff 70 04	 push	 DWORD PTR [eax+4]
  00025	ff 30		 push	 DWORD PTR [eax]
  00027	e8 00 00 00 00	 call	 ___stdio_common_vfprintf
  0002c	83 c4 18	 add	 esp, 24			; 00000018H

; 839  :         _Result = _vfprintf_l(_Stream, _Format, NULL, _ArgList);

  0002f	89 45 f4	 mov	 DWORD PTR __Result$[ebp], eax

; 840  :         __crt_va_end(_ArgList);

  00032	83 65 fc 00	 and	 DWORD PTR __ArgList$[ebp], 0

; 841  :         return _Result;

  00036	8b 45 f4	 mov	 eax, DWORD PTR __Result$[ebp]

; 842  :     }

  00039	c9		 leave
  0003a	c3		 ret	 0
_fprintf ENDP
_TEXT	ENDS
; Function compile flags: /Odspy
; File C:\Program Files (x86)\Windows Kits\10\Include\10.0.18362.0\ucrt\corecrt_stdio_config.h
;	COMDAT ___local_stdio_printf_options
_TEXT	SEGMENT
___local_stdio_printf_options PROC			; COMDAT

; 86   :     {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 87   :         static unsigned __int64 _OptionsStorage;
; 88   :         return &_OptionsStorage;

  00003	b8 00 00 00 00	 mov	 eax, OFFSET ?_OptionsStorage@?1??__local_stdio_printf_options@@9@4_KA ; `__local_stdio_printf_options'::`2'::_OptionsStorage

; 89   :     }

  00008	5d		 pop	 ebp
  00009	c3		 ret	 0
___local_stdio_printf_options ENDP
_TEXT	ENDS
END
