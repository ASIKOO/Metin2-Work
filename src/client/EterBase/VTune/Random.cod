; Listing generated by Microsoft (R) Optimizing Compiler Version 19.28.29335.0 

	TITLE	D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\Random.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?srandom@@YAXK@Z				; srandom
PUBLIC	?random@@YAKXZ					; random
PUBLIC	?frandom@@YAMMM@Z				; frandom
PUBLIC	?random_range@@YAJJJ@Z				; random_range
PUBLIC	__real@4f000000
PUBLIC	__xmm@41f00000000000000000000000000000
EXTRN	__fltused:DWORD
;	COMDAT __xmm@41f00000000000000000000000000000
CONST	SEGMENT
__xmm@41f00000000000000000000000000000 DB 00H, 00H, 00H, 00H, 00H, 00H, 00H
	DB	00H, 00H, 00H, 00H, 00H, 00H, 00H, 0f0H, 'A'
CONST	ENDS
;	COMDAT __real@4f000000
CONST	SEGMENT
__real@4f000000 DD 04f000000r			; 2.14748e+09
CONST	ENDS
_DATA	SEGMENT
?randseed@@3KA DD 01H					; randseed
_DATA	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\Random.cpp
;	COMDAT ?random_range@@YAJJJ@Z
_TEXT	SEGMENT
_from$ = 8						; size = 4
_to$ = 12						; size = 4
?random_range@@YAJJJ@Z PROC				; random_range, COMDAT

; 45   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 46   : 	assert(from <= to);
; 47   : 	return ((random() % (to - from + 1)) + from);

  00003	e8 00 00 00 00	 call	 ?random@@YAKXZ		; random
  00008	8b 4d 0c	 mov	 ecx, DWORD PTR _to$[ebp]
  0000b	2b 4d 08	 sub	 ecx, DWORD PTR _from$[ebp]
  0000e	41		 inc	 ecx
  0000f	33 d2		 xor	 edx, edx
  00011	f7 f1		 div	 ecx
  00013	03 55 08	 add	 edx, DWORD PTR _from$[ebp]
  00016	8b c2		 mov	 eax, edx

; 48   : }

  00018	5d		 pop	 ebp
  00019	c3		 ret	 0
?random_range@@YAJJJ@Z ENDP				; random_range
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\Random.cpp
;	COMDAT ?frandom@@YAMMM@Z
_TEXT	SEGMENT
tv75 = -20						; size = 8
tv82 = -12						; size = 4
_fl$ = -8						; size = 4
tv72 = -4						; size = 4
_flLow$ = 8						; size = 4
_flHigh$ = 12						; size = 4
?frandom@@YAMMM@Z PROC					; frandom, COMDAT

; 39   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 14	 sub	 esp, 20			; 00000014H

; 40   : 	float fl = float(random()) / float(2147483648.0f); // float in [0,1)

  00006	e8 00 00 00 00	 call	 ?random@@YAKXZ		; random
  0000b	89 45 fc	 mov	 DWORD PTR tv72[ebp], eax
  0000e	f2 0f 2a 45 fc	 cvtsi2sd xmm0, DWORD PTR tv72[ebp]
  00013	8b 45 fc	 mov	 eax, DWORD PTR tv72[ebp]
  00016	c1 e8 1f	 shr	 eax, 31			; 0000001fH
  00019	f2 0f 58 04 c5
	00 00 00 00	 addsd	 xmm0, QWORD PTR __xmm@41f00000000000000000000000000000[eax*8]
  00022	f2 0f 11 45 ec	 movsd	 QWORD PTR tv75[ebp], xmm0
  00027	f2 0f 5a 45 ec	 cvtsd2ss xmm0, QWORD PTR tv75[ebp]
  0002c	f3 0f 5e 05 00
	00 00 00	 divss	 xmm0, DWORD PTR __real@4f000000
  00034	f3 0f 11 45 f8	 movss	 DWORD PTR _fl$[ebp], xmm0

; 41   : 	return (fl * (flHigh - flLow)) + flLow; // float in [low,high)

  00039	f3 0f 10 45 0c	 movss	 xmm0, DWORD PTR _flHigh$[ebp]
  0003e	f3 0f 5c 45 08	 subss	 xmm0, DWORD PTR _flLow$[ebp]
  00043	f3 0f 59 45 f8	 mulss	 xmm0, DWORD PTR _fl$[ebp]
  00048	f3 0f 58 45 08	 addss	 xmm0, DWORD PTR _flLow$[ebp]
  0004d	f3 0f 11 45 f4	 movss	 DWORD PTR tv82[ebp], xmm0
  00052	d9 45 f4	 fld	 DWORD PTR tv82[ebp]

; 42   : }

  00055	c9		 leave
  00056	c3		 ret	 0
?frandom@@YAMMM@Z ENDP					; frandom
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\Random.cpp
;	COMDAT ?random@@YAKXZ
_TEXT	SEGMENT
_hi$ = -16						; size = 4
_lo$ = -12						; size = 4
_x$ = -8						; size = 4
_t$ = -4						; size = 4
?random@@YAKXZ PROC					; random, COMDAT

; 18   : {       

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 10	 sub	 esp, 16			; 00000010H

; 19   : 	register long x, hi, lo, t;
; 20   : 	
; 21   : 	/*
; 22   : 	* Compute x[n + 1] = (7^5 * x[n]) mod (2^31 - 1).
; 23   : 	* From "Random number generators: good ones are hard to find",
; 24   : 	* Park and Miller, Communications of the ACM, vol. 31, no. 10,
; 25   : 	* October 1988, p. 1195.
; 26   : 	*/ 
; 27   : 	x = randseed;

  00006	a1 00 00 00 00	 mov	 eax, DWORD PTR ?randseed@@3KA
  0000b	89 45 f8	 mov	 DWORD PTR _x$[ebp], eax

; 28   : 	hi = x / 127773;

  0000e	8b 45 f8	 mov	 eax, DWORD PTR _x$[ebp]
  00011	99		 cdq
  00012	b9 1d f3 01 00	 mov	 ecx, 127773		; 0001f31dH
  00017	f7 f9		 idiv	 ecx
  00019	89 45 f0	 mov	 DWORD PTR _hi$[ebp], eax

; 29   : 	lo = x % 127773; 

  0001c	8b 45 f8	 mov	 eax, DWORD PTR _x$[ebp]
  0001f	99		 cdq
  00020	b9 1d f3 01 00	 mov	 ecx, 127773		; 0001f31dH
  00025	f7 f9		 idiv	 ecx
  00027	89 55 f4	 mov	 DWORD PTR _lo$[ebp], edx

; 30   : 	t = 16807 * lo - 2836 * hi;

  0002a	69 45 f4 a7 41
	00 00		 imul	 eax, DWORD PTR _lo$[ebp], 16807
  00031	69 4d f0 14 0b
	00 00		 imul	 ecx, DWORD PTR _hi$[ebp], 2836
  00038	2b c1		 sub	 eax, ecx
  0003a	89 45 fc	 mov	 DWORD PTR _t$[ebp], eax

; 31   : 	if (t <= 0)

  0003d	83 7d fc 00	 cmp	 DWORD PTR _t$[ebp], 0
  00041	7f 0b		 jg	 SHORT $LN2@random

; 32   : 		t += 0x7fffffff;

  00043	8b 45 fc	 mov	 eax, DWORD PTR _t$[ebp]
  00046	05 ff ff ff 7f	 add	 eax, 2147483647		; 7fffffffH
  0004b	89 45 fc	 mov	 DWORD PTR _t$[ebp], eax
$LN2@random:

; 33   : 	randseed = t;

  0004e	8b 45 fc	 mov	 eax, DWORD PTR _t$[ebp]
  00051	a3 00 00 00 00	 mov	 DWORD PTR ?randseed@@3KA, eax

; 34   : 	return (t);

  00056	8b 45 fc	 mov	 eax, DWORD PTR _t$[ebp]

; 35   : }

  00059	c9		 leave
  0005a	c3		 ret	 0
?random@@YAKXZ ENDP					; random
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\EterBase\Random.cpp
;	COMDAT ?srandom@@YAXK@Z
_TEXT	SEGMENT
_seed$ = 8						; size = 4
?srandom@@YAXK@Z PROC					; srandom, COMDAT

; 8    : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 9    : 	randseed = seed;

  00003	8b 45 08	 mov	 eax, DWORD PTR _seed$[ebp]
  00006	a3 00 00 00 00	 mov	 DWORD PTR ?randseed@@3KA, eax

; 10   : }

  0000b	5d		 pop	 ebp
  0000c	c3		 ret	 0
?srandom@@YAXK@Z ENDP					; srandom
_TEXT	ENDS
END
