; Listing generated by Microsoft (R) Optimizing Compiler Version 19.28.29335.0 

	TITLE	D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMT
INCLUDELIB OLDNAMES

PUBLIC	?Update@CGrannyModelInstance@@QAEXK@Z		; CGrannyModelInstance::Update
PUBLIC	?UpdateLocalTime@CGrannyModelInstance@@QAEXM@Z	; CGrannyModelInstance::UpdateLocalTime
PUBLIC	?UpdateTransform@CGrannyModelInstance@@QAEXPAUD3DXMATRIX@@M@Z ; CGrannyModelInstance::UpdateTransform
PUBLIC	?UpdateSkeleton@CGrannyModelInstance@@QAEXPBUD3DXMATRIX@@M@Z ; CGrannyModelInstance::UpdateSkeleton
PUBLIC	?Deform@CGrannyModelInstance@@QAEXPBUD3DXMATRIX@@@Z ; CGrannyModelInstance::Deform
PUBLIC	?UpdateWorldPose@CGrannyModelInstance@@IAEXXZ	; CGrannyModelInstance::UpdateWorldPose
PUBLIC	?UpdateWorldMatrices@CGrannyModelInstance@@IAEXPBUD3DXMATRIX@@@Z ; CGrannyModelInstance::UpdateWorldMatrices
PUBLIC	?DeformPNTVertices@CGrannyModelInstance@@IAEXPAX@Z ; CGrannyModelInstance::DeformPNTVertices
PUBLIC	?Get@CGrannyLocalPose@@QAEPAUgranny_local_pose@@H@Z ; CGrannyLocalPose::Get
PUBLIC	??_GCGrannyLocalPose@@UAEPAXI@Z			; CGrannyLocalPose::`scalar deleting destructor'
PUBLIC	??_C@_0EC@DKCFBIDP@CGrannyModelIstance?3?3UpdateTran@ ; `string'
PUBLIC	??_C@_0CI@PBPMOHGO@GRANNY?5DEFORM?5DYNAMIC?5BUFFER?5LO@ ; `string'
PUBLIC	??_7CGrannyLocalPose@@6B@			; CGrannyLocalPose::`vftable'
PUBLIC	??_R4CGrannyLocalPose@@6B@			; CGrannyLocalPose::`RTTI Complete Object Locator'
PUBLIC	??_R0?AVCGrannyLocalPose@@@8			; CGrannyLocalPose `RTTI Type Descriptor'
PUBLIC	??_R3CGrannyLocalPose@@8			; CGrannyLocalPose::`RTTI Class Hierarchy Descriptor'
PUBLIC	??_R2CGrannyLocalPose@@8			; CGrannyLocalPose::`RTTI Base Class Array'
PUBLIC	??_R1A@?0A@EA@CGrannyLocalPose@@8		; CGrannyLocalPose::`RTTI Base Class Descriptor at (0,-1,0,64)'
PUBLIC	__real@42f00000
EXTRN	??3@YAXPAXI@Z:PROC				; operator delete
EXTRN	_atexit:PROC
EXTRN	__Init_thread_header:PROC
EXTRN	__Init_thread_footer:PROC
EXTRN	__imp__GrannyGetSourceSkeleton@4:PROC
EXTRN	__imp__GrannySetModelClock@8:PROC
EXTRN	__imp__GrannyFreeCompletedModelControls@4:PROC
EXTRN	__imp__GrannySampleModelAnimationsAccelerated@20:PROC
EXTRN	__imp__GrannyUpdateModelMatrix@20:PROC
EXTRN	__imp__GrannyNewLocalPose@4:PROC
EXTRN	__imp__GrannyFreeLocalPose@4:PROC
EXTRN	__imp__GrannyGetWorldPoseComposite4x4Array@4:PROC
EXTRN	?TraceError@@YAXPBDZZ:PROC			; TraceError
EXTRN	_D3DXMatrixMultiply@12:PROC
EXTRN	?LockRange@CGraphicVertexBuffer@@QBE_NIPAPAX@Z:PROC ; CGraphicVertexBuffer::LockRange
EXTRN	?Unlock@CGraphicVertexBuffer@@QAE_NXZ:PROC	; CGraphicVertexBuffer::Unlock
EXTRN	?CanDeformPNTVertices@CGrannyMesh@@QBE_NXZ:PROC	; CGrannyMesh::CanDeformPNTVertices
EXTRN	?GetDeformVertexCount@CGrannyModel@@QBEHXZ:PROC	; CGrannyModel::GetDeformVertexCount
EXTRN	?CanDeformPNTVertices@CGrannyModel@@QBE_NXZ:PROC ; CGrannyModel::CanDeformPNTVertices
EXTRN	?DeformPNTVertices@CGrannyModel@@QBEXPAXPAUD3DXMATRIX@@ABV?$vector@PAUgranny_mesh_binding@@V?$allocator@PAUgranny_mesh_binding@@@std@@@std@@@Z:PROC ; CGrannyModel::DeformPNTVertices
EXTRN	?GetMeshCount@CGrannyModel@@QBEHXZ:PROC		; CGrannyModel::GetMeshCount
EXTRN	?GetMeshPointer@CGrannyModel@@QAEPAVCGrannyMesh@@H@Z:PROC ; CGrannyModel::GetMeshPointer
EXTRN	?IsEmpty@CGrannyModelInstance@@QAE_NXZ:PROC	; CGrannyModelInstance::IsEmpty
EXTRN	?GetLocalTime@CGrannyModelInstance@@QAEMXZ:PROC	; CGrannyModelInstance::GetLocalTime
EXTRN	?GetBoneMatrixPointer@CGrannyModelInstance@@QBEPBMH@Z:PROC ; CGrannyModelInstance::GetBoneMatrixPointer
EXTRN	?__GetMeshBoneIndices@CGrannyModelInstance@@IBEPAHI@Z:PROC ; CGrannyModelInstance::__GetMeshBoneIndices
EXTRN	?__GetDeformableVertexBufferRef@CGrannyModelInstance@@IAEAAVCGraphicVertexBuffer@@XZ:PROC ; CGrannyModelInstance::__GetDeformableVertexBufferRef
EXTRN	?__GetWorldPosePtr@CGrannyModelInstance@@IBEPAUgranny_world_pose@@XZ:PROC ; CGrannyModelInstance::__GetWorldPosePtr
EXTRN	??_ECGrannyLocalPose@@UAEPAXI@Z:PROC		; CGrannyLocalPose::`vector deleting destructor'
EXTRN	__ftoui3:PROC
EXTRN	__Init_thread_epoch:DWORD
EXTRN	??_7type_info@@6B@:QWORD			; type_info::`vftable'
EXTRN	__fltused:DWORD
EXTRN	__tls_array:DWORD
EXTRN	__tls_index:DWORD
;	COMDAT ?s_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4VCGrannyLocalPose@@A
_BSS	SEGMENT
?s_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4VCGrannyLocalPose@@A DB 0cH DUP (?) ; `CGrannyModelInstance::UpdateWorldPose'::`2'::s_SharedLocalPose
_BSS	ENDS
;	COMDAT ?$TSS0@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4HA
_BSS	SEGMENT
?$TSS0@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4HA DD 01H DUP (?) ; `CGrannyModelInstance::UpdateWorldPose'::`2'::$TSS0
_BSS	ENDS
;	COMDAT __real@42f00000
CONST	SEGMENT
__real@42f00000 DD 042f00000r			; 120
CONST	ENDS
;	COMDAT ??_R1A@?0A@EA@CGrannyLocalPose@@8
rdata$r	SEGMENT
??_R1A@?0A@EA@CGrannyLocalPose@@8 DD FLAT:??_R0?AVCGrannyLocalPose@@@8 ; CGrannyLocalPose::`RTTI Base Class Descriptor at (0,-1,0,64)'
	DD	00H
	DD	00H
	DD	0ffffffffH
	DD	00H
	DD	040H
	DD	FLAT:??_R3CGrannyLocalPose@@8
rdata$r	ENDS
;	COMDAT ??_R2CGrannyLocalPose@@8
rdata$r	SEGMENT
??_R2CGrannyLocalPose@@8 DD FLAT:??_R1A@?0A@EA@CGrannyLocalPose@@8 ; CGrannyLocalPose::`RTTI Base Class Array'
rdata$r	ENDS
;	COMDAT ??_R3CGrannyLocalPose@@8
rdata$r	SEGMENT
??_R3CGrannyLocalPose@@8 DD 00H				; CGrannyLocalPose::`RTTI Class Hierarchy Descriptor'
	DD	00H
	DD	01H
	DD	FLAT:??_R2CGrannyLocalPose@@8
rdata$r	ENDS
;	COMDAT ??_R0?AVCGrannyLocalPose@@@8
data$rs	SEGMENT
??_R0?AVCGrannyLocalPose@@@8 DD FLAT:??_7type_info@@6B@	; CGrannyLocalPose `RTTI Type Descriptor'
	DD	00H
	DB	'.?AVCGrannyLocalPose@@', 00H
data$rs	ENDS
;	COMDAT ??_R4CGrannyLocalPose@@6B@
rdata$r	SEGMENT
??_R4CGrannyLocalPose@@6B@ DD 00H			; CGrannyLocalPose::`RTTI Complete Object Locator'
	DD	00H
	DD	00H
	DD	FLAT:??_R0?AVCGrannyLocalPose@@@8
	DD	FLAT:??_R3CGrannyLocalPose@@8
rdata$r	ENDS
;	COMDAT ??_7CGrannyLocalPose@@6B@
CONST	SEGMENT
??_7CGrannyLocalPose@@6B@ DD FLAT:??_R4CGrannyLocalPose@@6B@ ; CGrannyLocalPose::`vftable'
	DD	FLAT:??_ECGrannyLocalPose@@UAEPAXI@Z
CONST	ENDS
;	COMDAT ??_C@_0CI@PBPMOHGO@GRANNY?5DEFORM?5DYNAMIC?5BUFFER?5LO@
CONST	SEGMENT
??_C@_0CI@PBPMOHGO@GRANNY?5DEFORM?5DYNAMIC?5BUFFER?5LO@ DB 'GRANNY DEFORM'
	DB	' DYNAMIC BUFFER LOCK ERROR', 00H		; `string'
CONST	ENDS
;	COMDAT ??_C@_0EC@DKCFBIDP@CGrannyModelIstance?3?3UpdateTran@
CONST	SEGMENT
??_C@_0EC@DKCFBIDP@CGrannyModelIstance?3?3UpdateTran@ DB 'CGrannyModelIst'
	DB	'ance::UpdateTransform - m_pgrnModelInstance = NULL', 00H ; `string'
CONST	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ??__Fs_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@YAXXZ
text$yd	SEGMENT
??__Fs_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@YAXXZ PROC ; `CGrannyModelInstance::UpdateWorldPose'::`2'::`dynamic atexit destructor for 's_SharedLocalPose'', COMDAT
  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp

; 96   : 		{

  00003	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?s_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4VCGrannyLocalPose@@A, OFFSET ??_7CGrannyLocalPose@@6B@

; 97   : 			if (m_pgrnLocalPose)

  0000d	83 3d 04 00 00
	00 00		 cmp	 DWORD PTR ?s_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4VCGrannyLocalPose@@A+4, 0
  00014	74 0c		 je	 SHORT $LN1@dynamic

; 98   : 				GrannyFreeLocalPose(m_pgrnLocalPose);

  00016	ff 35 04 00 00
	00		 push	 DWORD PTR ?s_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4VCGrannyLocalPose@@A+4
  0001c	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannyFreeLocalPose@4
$LN1@dynamic:
  00022	5d		 pop	 ebp
  00023	c3		 ret	 0
??__Fs_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@YAXXZ ENDP ; `CGrannyModelInstance::UpdateWorldPose'::`2'::`dynamic atexit destructor for 's_SharedLocalPose''
text$yd	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ??_GCGrannyLocalPose@@UAEPAXI@Z
_TEXT	SEGMENT
_this$ = -4						; size = 4
___flags$ = 8						; size = 4
??_GCGrannyLocalPose@@UAEPAXI@Z PROC			; CGrannyLocalPose::`scalar deleting destructor', COMDAT
; _this$ = ecx
  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 96   : 		{

  00007	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0000a	c7 00 00 00 00
	00		 mov	 DWORD PTR [eax], OFFSET ??_7CGrannyLocalPose@@6B@

; 97   : 			if (m_pgrnLocalPose)

  00010	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00013	83 78 04 00	 cmp	 DWORD PTR [eax+4], 0
  00017	74 0c		 je	 SHORT $LN6@scalar

; 98   : 				GrannyFreeLocalPose(m_pgrnLocalPose);

  00019	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0001c	ff 70 04	 push	 DWORD PTR [eax+4]
  0001f	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannyFreeLocalPose@4
$LN6@scalar:
  00025	8b 45 08	 mov	 eax, DWORD PTR ___flags$[ebp]
  00028	83 e0 01	 and	 eax, 1
  0002b	74 0c		 je	 SHORT $LN2@scalar
  0002d	6a 0c		 push	 12			; 0000000cH
  0002f	ff 75 fc	 push	 DWORD PTR _this$[ebp]
  00032	e8 00 00 00 00	 call	 ??3@YAXPAXI@Z		; operator delete
  00037	59		 pop	 ecx
  00038	59		 pop	 ecx
$LN2@scalar:
  00039	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0003c	c9		 leave
  0003d	c2 04 00	 ret	 4
??_GCGrannyLocalPose@@UAEPAXI@Z ENDP			; CGrannyLocalPose::`scalar deleting destructor'
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ?Get@CGrannyLocalPose@@QAEPAUgranny_local_pose@@H@Z
_TEXT	SEGMENT
_this$ = -4						; size = 4
_boneCount$ = 8						; size = 4
?Get@CGrannyLocalPose@@QAEPAUgranny_local_pose@@H@Z PROC ; CGrannyLocalPose::Get, COMDAT
; _this$ = ecx

; 102  : 		{

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 103  : 			if (m_pgrnLocalPose)

  00007	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0000a	83 78 04 00	 cmp	 DWORD PTR [eax+4], 0
  0000e	74 1f		 je	 SHORT $LN2@Get

; 104  : 			{
; 105  : 				if (m_boneCount >= boneCount)

  00010	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00013	8b 40 08	 mov	 eax, DWORD PTR [eax+8]
  00016	3b 45 08	 cmp	 eax, DWORD PTR _boneCount$[ebp]
  00019	7c 08		 jl	 SHORT $LN3@Get

; 106  : 					return m_pgrnLocalPose;

  0001b	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0001e	8b 40 04	 mov	 eax, DWORD PTR [eax+4]
  00021	eb 2d		 jmp	 SHORT $LN1@Get
$LN3@Get:

; 107  : 
; 108  : 				GrannyFreeLocalPose(m_pgrnLocalPose);

  00023	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00026	ff 70 04	 push	 DWORD PTR [eax+4]
  00029	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannyFreeLocalPose@4
$LN2@Get:

; 109  : 			}
; 110  : 
; 111  : 			m_boneCount = boneCount;

  0002f	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00032	8b 4d 08	 mov	 ecx, DWORD PTR _boneCount$[ebp]
  00035	89 48 08	 mov	 DWORD PTR [eax+8], ecx

; 112  : 			m_pgrnLocalPose = GrannyNewLocalPose(m_boneCount);

  00038	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0003b	ff 70 08	 push	 DWORD PTR [eax+8]
  0003e	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannyNewLocalPose@4
  00044	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  00047	89 41 04	 mov	 DWORD PTR [ecx+4], eax

; 113  : 			return m_pgrnLocalPose;

  0004a	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0004d	8b 40 04	 mov	 eax, DWORD PTR [eax+4]
$LN1@Get:

; 114  : 		}

  00050	c9		 leave
  00051	c2 04 00	 ret	 4
?Get@CGrannyLocalPose@@QAEPAUgranny_local_pose@@H@Z ENDP ; CGrannyLocalPose::Get
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ?DeformPNTVertices@CGrannyModelInstance@@IAEXPAX@Z
_TEXT	SEGMENT
_this$ = -4						; size = 4
_pvDest$ = 8						; size = 4
?DeformPNTVertices@CGrannyModelInstance@@IAEXPAX@Z PROC	; CGrannyModelInstance::DeformPNTVertices, COMDAT
; _this$ = ecx

; 199  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 200  : 	assert(m_pModel != NULL);
; 201  : 	assert(m_pModel->CanDeformPNTVertices());
; 202  : 
; 203  : 	// WORK
; 204  : 	m_pModel->DeformPNTVertices(pvDest, (D3DXMATRIX *) GrannyGetWorldPoseComposite4x4Array(__GetWorldPosePtr()), m_vct_pgrnMeshBinding);

  00007	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0000a	83 c0 40	 add	 eax, 64			; 00000040H
  0000d	50		 push	 eax
  0000e	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  00011	e8 00 00 00 00	 call	 ?__GetWorldPosePtr@CGrannyModelInstance@@IBEPAUgranny_world_pose@@XZ ; CGrannyModelInstance::__GetWorldPosePtr
  00016	50		 push	 eax
  00017	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannyGetWorldPoseComposite4x4Array@4
  0001d	50		 push	 eax
  0001e	ff 75 08	 push	 DWORD PTR _pvDest$[ebp]
  00021	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00024	8b 48 04	 mov	 ecx, DWORD PTR [eax+4]
  00027	e8 00 00 00 00	 call	 ?DeformPNTVertices@CGrannyModel@@QBEXPAXPAUD3DXMATRIX@@ABV?$vector@PAUgranny_mesh_binding@@V?$allocator@PAUgranny_mesh_binding@@@std@@@std@@@Z ; CGrannyModel::DeformPNTVertices

; 205  : 	// END_OF_WORK
; 206  : }

  0002c	c9		 leave
  0002d	c2 04 00	 ret	 4
?DeformPNTVertices@CGrannyModelInstance@@IAEXPAX@Z ENDP	; CGrannyModelInstance::DeformPNTVertices
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ?UpdateWorldMatrices@CGrannyModelInstance@@IAEXPBUD3DXMATRIX@@@Z
_TEXT	SEGMENT
_boneMatrices$ = -36					; size = 4
_iBone$1 = -32						; size = 4
_boneIndices$2 = -28					; size = 4
_pMesh$3 = -24						; size = 4
_meshCount$ = -20					; size = 4
_pgrnMatCompositeBuffer$ = -16				; size = 4
_rWorldMatrix$4 = -12					; size = 4
_this$ = -8						; size = 4
_i$5 = -4						; size = 4
_c_pWorldMatrix$ = 8					; size = 4
?UpdateWorldMatrices@CGrannyModelInstance@@IAEXPBUD3DXMATRIX@@@Z PROC ; CGrannyModelInstance::UpdateWorldMatrices, COMDAT
; _this$ = ecx

; 158  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 24	 sub	 esp, 36			; 00000024H
  00006	56		 push	 esi
  00007	57		 push	 edi
  00008	89 4d f8	 mov	 DWORD PTR _this$[ebp], ecx

; 159  : 	// NO_MESH_BUG_FIX
; 160  : 	if (!m_meshMatrices)

  0000b	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  0000e	83 78 14 00	 cmp	 DWORD PTR [eax+20], 0
  00012	75 05		 jne	 SHORT $LN5@UpdateWorl

; 161  : 		return;

  00014	e9 a4 00 00 00	 jmp	 $LN1@UpdateWorl
$LN5@UpdateWorl:

; 162  : 	// END_OF_NO_MESH_BUG_FIX
; 163  : 	
; 164  : 	assert(m_pModel != NULL);
; 165  : 	assert(ms_lpd3dMatStack != NULL);
; 166  : 	
; 167  : 	int meshCount = m_pModel->GetMeshCount();

  00019	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  0001c	8b 48 04	 mov	 ecx, DWORD PTR [eax+4]
  0001f	e8 00 00 00 00	 call	 ?GetMeshCount@CGrannyModel@@QBEHXZ ; CGrannyModel::GetMeshCount
  00024	89 45 ec	 mov	 DWORD PTR _meshCount$[ebp], eax

; 168  : 	
; 169  : 	granny_matrix_4x4 * pgrnMatCompositeBuffer = GrannyGetWorldPoseComposite4x4Array(__GetWorldPosePtr());

  00027	8b 4d f8	 mov	 ecx, DWORD PTR _this$[ebp]
  0002a	e8 00 00 00 00	 call	 ?__GetWorldPosePtr@CGrannyModelInstance@@IBEPAUgranny_world_pose@@XZ ; CGrannyModelInstance::__GetWorldPosePtr
  0002f	50		 push	 eax
  00030	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannyGetWorldPoseComposite4x4Array@4
  00036	89 45 f0	 mov	 DWORD PTR _pgrnMatCompositeBuffer$[ebp], eax

; 170  : 	D3DXMATRIX * boneMatrices = (D3DXMATRIX *) pgrnMatCompositeBuffer;

  00039	8b 45 f0	 mov	 eax, DWORD PTR _pgrnMatCompositeBuffer$[ebp]
  0003c	89 45 dc	 mov	 DWORD PTR _boneMatrices$[ebp], eax

; 171  : 
; 172  : 	for (int i = 0; i < meshCount; ++i)

  0003f	83 65 fc 00	 and	 DWORD PTR _i$5[ebp], 0
  00043	eb 07		 jmp	 SHORT $LN4@UpdateWorl
$LN2@UpdateWorl:
  00045	8b 45 fc	 mov	 eax, DWORD PTR _i$5[ebp]
  00048	40		 inc	 eax
  00049	89 45 fc	 mov	 DWORD PTR _i$5[ebp], eax
$LN4@UpdateWorl:
  0004c	8b 45 fc	 mov	 eax, DWORD PTR _i$5[ebp]
  0004f	3b 45 ec	 cmp	 eax, DWORD PTR _meshCount$[ebp]
  00052	7d 69		 jge	 SHORT $LN1@UpdateWorl

; 173  : 	{
; 174  : 		D3DXMATRIX & rWorldMatrix = m_meshMatrices[i];

  00054	8b 45 fc	 mov	 eax, DWORD PTR _i$5[ebp]
  00057	c1 e0 06	 shl	 eax, 6
  0005a	8b 4d f8	 mov	 ecx, DWORD PTR _this$[ebp]
  0005d	03 41 14	 add	 eax, DWORD PTR [ecx+20]
  00060	89 45 f4	 mov	 DWORD PTR _rWorldMatrix$4[ebp], eax

; 175  : 
; 176  : 		const CGrannyMesh * pMesh = m_pModel->GetMeshPointer(i);

  00063	ff 75 fc	 push	 DWORD PTR _i$5[ebp]
  00066	8b 45 f8	 mov	 eax, DWORD PTR _this$[ebp]
  00069	8b 48 04	 mov	 ecx, DWORD PTR [eax+4]
  0006c	e8 00 00 00 00	 call	 ?GetMeshPointer@CGrannyModel@@QAEPAVCGrannyMesh@@H@Z ; CGrannyModel::GetMeshPointer
  00071	89 45 e8	 mov	 DWORD PTR _pMesh$3[ebp], eax

; 177  : 
; 178  : 		// WORK
; 179  : 		int * boneIndices = __GetMeshBoneIndices(i);

  00074	ff 75 fc	 push	 DWORD PTR _i$5[ebp]
  00077	8b 4d f8	 mov	 ecx, DWORD PTR _this$[ebp]
  0007a	e8 00 00 00 00	 call	 ?__GetMeshBoneIndices@CGrannyModelInstance@@IBEPAHI@Z ; CGrannyModelInstance::__GetMeshBoneIndices
  0007f	89 45 e4	 mov	 DWORD PTR _boneIndices$2[ebp], eax

; 180  : 		// END_OF_WORK
; 181  : 
; 182  : 		if (pMesh->CanDeformPNTVertices())

  00082	8b 4d e8	 mov	 ecx, DWORD PTR _pMesh$3[ebp]
  00085	e8 00 00 00 00	 call	 ?CanDeformPNTVertices@CGrannyMesh@@QBE_NXZ ; CGrannyMesh::CanDeformPNTVertices
  0008a	0f b6 c0	 movzx	 eax, al
  0008d	85 c0		 test	 eax, eax
  0008f	74 0d		 je	 SHORT $LN6@UpdateWorl

; 183  : 		{
; 184  : 			rWorldMatrix = *c_pWorldMatrix;			

  00091	6a 10		 push	 16			; 00000010H
  00093	59		 pop	 ecx
  00094	8b 75 08	 mov	 esi, DWORD PTR _c_pWorldMatrix$[ebp]
  00097	8b 7d f4	 mov	 edi, DWORD PTR _rWorldMatrix$4[ebp]
  0009a	f3 a5		 rep movsd

; 185  : 		}

  0009c	eb 1d		 jmp	 SHORT $LN7@UpdateWorl
$LN6@UpdateWorl:

; 186  : 		else
; 187  : 		{
; 188  : 			int iBone = *boneIndices;

  0009e	8b 45 e4	 mov	 eax, DWORD PTR _boneIndices$2[ebp]
  000a1	8b 00		 mov	 eax, DWORD PTR [eax]
  000a3	89 45 e0	 mov	 DWORD PTR _iBone$1[ebp], eax

; 189  : 			D3DXMatrixMultiply(&rWorldMatrix, &boneMatrices[iBone], c_pWorldMatrix);

  000a6	ff 75 08	 push	 DWORD PTR _c_pWorldMatrix$[ebp]
  000a9	8b 45 e0	 mov	 eax, DWORD PTR _iBone$1[ebp]
  000ac	c1 e0 06	 shl	 eax, 6
  000af	03 45 dc	 add	 eax, DWORD PTR _boneMatrices$[ebp]
  000b2	50		 push	 eax
  000b3	ff 75 f4	 push	 DWORD PTR _rWorldMatrix$4[ebp]
  000b6	e8 00 00 00 00	 call	 _D3DXMatrixMultiply@12
$LN7@UpdateWorl:

; 190  : 		}
; 191  : 	}

  000bb	eb 88		 jmp	 SHORT $LN2@UpdateWorl
$LN1@UpdateWorl:

; 192  : 
; 193  : #ifdef _TEST
; 194  : 	TEST_matWorld = *c_pWorldMatrix;
; 195  : #endif
; 196  : }

  000bd	5f		 pop	 edi
  000be	5e		 pop	 esi
  000bf	c9		 leave
  000c0	c2 04 00	 ret	 4
?UpdateWorldMatrices@CGrannyModelInstance@@IAEXPBUD3DXMATRIX@@@Z ENDP ; CGrannyModelInstance::UpdateWorldMatrices
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ?UpdateWorldPose@CGrannyModelInstance@@IAEXXZ
_TEXT	SEGMENT
_pAttachBoneMatrix$ = -20				; size = 4
_pgrnLocalPose$ = -16					; size = 4
_pgrnSkeleton$ = -12					; size = 4
tv93 = -8						; size = 4
_this$ = -4						; size = 4
?UpdateWorldPose@CGrannyModelInstance@@IAEXXZ PROC	; CGrannyModelInstance::UpdateWorldPose, COMDAT
; _this$ = ecx

; 132  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 14	 sub	 esp, 20			; 00000014H
  00006	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 133  : 	// WEP	= m_iParentBoneIndex != 0 -> UpdateWorldPose(O)
; 134  : 	// LOD	= UpdateWorldPose(O)
; 135  : 	// Hair	= UpdateWorldPose(X)
; 136  : 
; 137  : 	if (m_ppkSkeletonInst)

  00009	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0000c	83 78 74 00	 cmp	 DWORD PTR [eax+116], 0
  00010	74 12		 je	 SHORT $LN3@UpdateWorl

; 138  : 		if (*m_ppkSkeletonInst!=this)

  00012	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00015	8b 40 74	 mov	 eax, DWORD PTR [eax+116]
  00018	8b 00		 mov	 eax, DWORD PTR [eax]
  0001a	3b 45 fc	 cmp	 eax, DWORD PTR _this$[ebp]
  0001d	74 05		 je	 SHORT $LN3@UpdateWorl

; 139  : 			return;

  0001f	e9 d7 00 00 00	 jmp	 $LN1@UpdateWorl
$LN3@UpdateWorl:

; 140  : 	
; 141  : 	static CGrannyLocalPose s_SharedLocalPose;

  00024	a1 00 00 00 00	 mov	 eax, DWORD PTR __tls_index
  00029	64 8b 0d 00 00
	00 00		 mov	 ecx, DWORD PTR fs:__tls_array
  00030	8b 04 81	 mov	 eax, DWORD PTR [ecx+eax*4]
  00033	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR ?$TSS0@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4HA
  00039	3b 88 00 00 00
	00		 cmp	 ecx, DWORD PTR __Init_thread_epoch[eax]
  0003f	7e 42		 jle	 SHORT $LN2@UpdateWorl
  00041	68 00 00 00 00	 push	 OFFSET ?$TSS0@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4HA
  00046	e8 00 00 00 00	 call	 __Init_thread_header
  0004b	59		 pop	 ecx
  0004c	83 3d 00 00 00
	00 ff		 cmp	 DWORD PTR ?$TSS0@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4HA, -1
  00053	75 2e		 jne	 SHORT $LN2@UpdateWorl

; 89   : 		CGrannyLocalPose()

  00055	c7 05 00 00 00
	00 00 00 00 00	 mov	 DWORD PTR ?s_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4VCGrannyLocalPose@@A, OFFSET ??_7CGrannyLocalPose@@6B@

; 90   : 		{
; 91   : 			m_pgrnLocalPose = NULL;

  0005f	83 25 04 00 00
	00 00		 and	 DWORD PTR ?s_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4VCGrannyLocalPose@@A+4, 0

; 92   : 			m_boneCount = 0;

  00066	83 25 08 00 00
	00 00		 and	 DWORD PTR ?s_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4VCGrannyLocalPose@@A+8, 0

; 140  : 	
; 141  : 	static CGrannyLocalPose s_SharedLocalPose;

  0006d	68 00 00 00 00	 push	 OFFSET ??__Fs_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@YAXXZ ; `CGrannyModelInstance::UpdateWorldPose'::`2'::`dynamic atexit destructor for 's_SharedLocalPose''
  00072	e8 00 00 00 00	 call	 _atexit
  00077	59		 pop	 ecx
  00078	68 00 00 00 00	 push	 OFFSET ?$TSS0@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4HA
  0007d	e8 00 00 00 00	 call	 __Init_thread_footer
  00082	59		 pop	 ecx
$LN2@UpdateWorl:

; 142  : 
; 143  : 	granny_skeleton * pgrnSkeleton = GrannyGetSourceSkeleton(m_pgrnModelInstance);

  00083	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00086	ff 70 08	 push	 DWORD PTR [eax+8]
  00089	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannyGetSourceSkeleton@4
  0008f	89 45 f4	 mov	 DWORD PTR _pgrnSkeleton$[ebp], eax

; 144  : 	granny_local_pose * pgrnLocalPose = s_SharedLocalPose.Get(pgrnSkeleton->BoneCount);	

  00092	8b 45 f4	 mov	 eax, DWORD PTR _pgrnSkeleton$[ebp]
  00095	ff 70 04	 push	 DWORD PTR [eax+4]
  00098	b9 00 00 00 00	 mov	 ecx, OFFSET ?s_SharedLocalPose@?1??UpdateWorldPose@CGrannyModelInstance@@IAEXXZ@4VCGrannyLocalPose@@A
  0009d	e8 00 00 00 00	 call	 ?Get@CGrannyLocalPose@@QAEPAUgranny_local_pose@@H@Z ; CGrannyLocalPose::Get
  000a2	89 45 f0	 mov	 DWORD PTR _pgrnLocalPose$[ebp], eax

; 145  : 
; 146  : 	const float * pAttachBoneMatrix = (mc_pParentInstance) ? mc_pParentInstance->GetBoneMatrixPointer(m_iParentBoneIndex) : NULL;

  000a5	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  000a8	83 78 18 00	 cmp	 DWORD PTR [eax+24], 0
  000ac	74 16		 je	 SHORT $LN6@UpdateWorl
  000ae	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  000b1	ff 70 1c	 push	 DWORD PTR [eax+28]
  000b4	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  000b7	8b 48 18	 mov	 ecx, DWORD PTR [eax+24]
  000ba	e8 00 00 00 00	 call	 ?GetBoneMatrixPointer@CGrannyModelInstance@@QBEPBMH@Z ; CGrannyModelInstance::GetBoneMatrixPointer
  000bf	89 45 f8	 mov	 DWORD PTR tv93[ebp], eax
  000c2	eb 04		 jmp	 SHORT $LN7@UpdateWorl
$LN6@UpdateWorl:
  000c4	83 65 f8 00	 and	 DWORD PTR tv93[ebp], 0
$LN7@UpdateWorl:
  000c8	8b 45 f8	 mov	 eax, DWORD PTR tv93[ebp]
  000cb	89 45 ec	 mov	 DWORD PTR _pAttachBoneMatrix$[ebp], eax

; 147  : 
; 148  : 	GrannySampleModelAnimationsAccelerated(m_pgrnModelInstance, pgrnSkeleton->BoneCount, pAttachBoneMatrix, pgrnLocalPose, __GetWorldPosePtr());

  000ce	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  000d1	e8 00 00 00 00	 call	 ?__GetWorldPosePtr@CGrannyModelInstance@@IBEPAUgranny_world_pose@@XZ ; CGrannyModelInstance::__GetWorldPosePtr
  000d6	50		 push	 eax
  000d7	ff 75 f0	 push	 DWORD PTR _pgrnLocalPose$[ebp]
  000da	ff 75 ec	 push	 DWORD PTR _pAttachBoneMatrix$[ebp]
  000dd	8b 45 f4	 mov	 eax, DWORD PTR _pgrnSkeleton$[ebp]
  000e0	ff 70 04	 push	 DWORD PTR [eax+4]
  000e3	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  000e6	ff 70 08	 push	 DWORD PTR [eax+8]
  000e9	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannySampleModelAnimationsAccelerated@20

; 149  : 	/*
; 150  : 	GrannySampleModelAnimations(m_pgrnModelInstance, 0, pgrnSkeleton->BoneCount, pgrnLocalPose);
; 151  : 	GrannyBuildWorldPose(pgrnSkeleton, 0, pgrnSkeleton->BoneCount, pgrnLocalPose, pAttachBoneMatrix, m_pgrnWorldPose);
; 152  : 	*/
; 153  : 	GrannyFreeCompletedModelControls(m_pgrnModelInstance);	

  000ef	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  000f2	ff 70 08	 push	 DWORD PTR [eax+8]
  000f5	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannyFreeCompletedModelControls@4
$LN1@UpdateWorl:

; 154  : 
; 155  : }

  000fb	c9		 leave
  000fc	c3		 ret	 0
?UpdateWorldPose@CGrannyModelInstance@@IAEXXZ ENDP	; CGrannyModelInstance::UpdateWorldPose
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ?Deform@CGrannyModelInstance@@QAEXPBUD3DXMATRIX@@@Z
_TEXT	SEGMENT
_pntVertices$1 = -12					; size = 4
_rkDeformableVertexBuffer$2 = -8			; size = 4
_this$ = -4						; size = 4
_c_pWorldMatrix$ = 8					; size = 4
?Deform@CGrannyModelInstance@@QAEXPBUD3DXMATRIX@@@Z PROC ; CGrannyModelInstance::Deform, COMDAT
; _this$ = ecx

; 56   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 0c	 sub	 esp, 12			; 0000000cH
  00006	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 57   : 	if (IsEmpty())

  00009	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  0000c	e8 00 00 00 00	 call	 ?IsEmpty@CGrannyModelInstance@@QAE_NXZ ; CGrannyModelInstance::IsEmpty
  00011	0f b6 c0	 movzx	 eax, al
  00014	85 c0		 test	 eax, eax
  00016	74 02		 je	 SHORT $LN2@Deform

; 58   : 		return;

  00018	eb 6f		 jmp	 SHORT $LN1@Deform
$LN2@Deform:

; 59   : 
; 60   : 	// DELETED
; 61   : 	//m_pgrnWorldPose = m_pgrnWorldPoseReal;
; 62   : 	/////////////////////////////////////////////
; 63   : 	
; 64   : 	UpdateWorldPose();

  0001a	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  0001d	e8 00 00 00 00	 call	 ?UpdateWorldPose@CGrannyModelInstance@@IAEXXZ ; CGrannyModelInstance::UpdateWorldPose

; 65   : 	UpdateWorldMatrices(c_pWorldMatrix);

  00022	ff 75 08	 push	 DWORD PTR _c_pWorldMatrix$[ebp]
  00025	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  00028	e8 00 00 00 00	 call	 ?UpdateWorldMatrices@CGrannyModelInstance@@IAEXPBUD3DXMATRIX@@@Z ; CGrannyModelInstance::UpdateWorldMatrices

; 66   : 
; 67   : 	if (m_pModel->CanDeformPNTVertices())

  0002d	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00030	8b 48 04	 mov	 ecx, DWORD PTR [eax+4]
  00033	e8 00 00 00 00	 call	 ?CanDeformPNTVertices@CGrannyModel@@QBE_NXZ ; CGrannyModel::CanDeformPNTVertices
  00038	0f b6 c0	 movzx	 eax, al
  0003b	85 c0		 test	 eax, eax
  0003d	74 4a		 je	 SHORT $LN1@Deform

; 68   : 	{
; 69   : 		// WORK
; 70   : 		CGraphicVertexBuffer& rkDeformableVertexBuffer = __GetDeformableVertexBufferRef();

  0003f	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  00042	e8 00 00 00 00	 call	 ?__GetDeformableVertexBufferRef@CGrannyModelInstance@@IAEAAVCGraphicVertexBuffer@@XZ ; CGrannyModelInstance::__GetDeformableVertexBufferRef
  00047	89 45 f8	 mov	 DWORD PTR _rkDeformableVertexBuffer$2[ebp], eax

; 71   : 		TPNTVertex* pntVertices;
; 72   : 		if (rkDeformableVertexBuffer.LockRange(m_pModel->GetDeformVertexCount(), (void **)&pntVertices))

  0004a	8d 45 f4	 lea	 eax, DWORD PTR _pntVertices$1[ebp]
  0004d	50		 push	 eax
  0004e	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00051	8b 48 04	 mov	 ecx, DWORD PTR [eax+4]
  00054	e8 00 00 00 00	 call	 ?GetDeformVertexCount@CGrannyModel@@QBEHXZ ; CGrannyModel::GetDeformVertexCount
  00059	50		 push	 eax
  0005a	8b 4d f8	 mov	 ecx, DWORD PTR _rkDeformableVertexBuffer$2[ebp]
  0005d	e8 00 00 00 00	 call	 ?LockRange@CGraphicVertexBuffer@@QBE_NIPAPAX@Z ; CGraphicVertexBuffer::LockRange
  00062	0f b6 c0	 movzx	 eax, al
  00065	85 c0		 test	 eax, eax
  00067	74 15		 je	 SHORT $LN4@Deform

; 73   : 		{
; 74   : 			DeformPNTVertices(pntVertices);

  00069	ff 75 f4	 push	 DWORD PTR _pntVertices$1[ebp]
  0006c	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  0006f	e8 00 00 00 00	 call	 ?DeformPNTVertices@CGrannyModelInstance@@IAEXPAX@Z ; CGrannyModelInstance::DeformPNTVertices

; 75   : 			rkDeformableVertexBuffer.Unlock();

  00074	8b 4d f8	 mov	 ecx, DWORD PTR _rkDeformableVertexBuffer$2[ebp]
  00077	e8 00 00 00 00	 call	 ?Unlock@CGraphicVertexBuffer@@QAE_NXZ ; CGraphicVertexBuffer::Unlock

; 76   : 		}

  0007c	eb 0b		 jmp	 SHORT $LN1@Deform
$LN4@Deform:

; 77   : 		else
; 78   : 		{
; 79   : 			TraceError("GRANNY DEFORM DYNAMIC BUFFER LOCK ERROR");

  0007e	68 00 00 00 00	 push	 OFFSET ??_C@_0CI@PBPMOHGO@GRANNY?5DEFORM?5DYNAMIC?5BUFFER?5LO@
  00083	e8 00 00 00 00	 call	 ?TraceError@@YAXPBDZZ	; TraceError
  00088	59		 pop	 ecx
$LN1@Deform:

; 80   : 		}
; 81   : 		// END_OF_WORK
; 82   : 	}	
; 83   : }

  00089	c9		 leave
  0008a	c2 04 00	 ret	 4
?Deform@CGrannyModelInstance@@QAEXPBUD3DXMATRIX@@@Z ENDP ; CGrannyModelInstance::Deform
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ?UpdateSkeleton@CGrannyModelInstance@@QAEXPBUD3DXMATRIX@@M@Z
_TEXT	SEGMENT
_this$ = -4						; size = 4
_c_pWorldMatrix$ = 8					; size = 4
___formal$ = 12						; size = 4
?UpdateSkeleton@CGrannyModelInstance@@QAEXPBUD3DXMATRIX@@M@Z PROC ; CGrannyModelInstance::UpdateSkeleton, COMDAT
; _this$ = ecx

; 123  : {	

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 124  : 	// DELETED
; 125  : 	//m_pgrnWorldPose = m_pgrnWorldPoseReal;
; 126  : 	///////////////////////////////////////////
; 127  : 	UpdateWorldPose();

  00007	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  0000a	e8 00 00 00 00	 call	 ?UpdateWorldPose@CGrannyModelInstance@@IAEXXZ ; CGrannyModelInstance::UpdateWorldPose

; 128  : 	UpdateWorldMatrices(c_pWorldMatrix);

  0000f	ff 75 08	 push	 DWORD PTR _c_pWorldMatrix$[ebp]
  00012	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  00015	e8 00 00 00 00	 call	 ?UpdateWorldMatrices@CGrannyModelInstance@@IAEXPBUD3DXMATRIX@@@Z ; CGrannyModelInstance::UpdateWorldMatrices

; 129  : }

  0001a	c9		 leave
  0001b	c2 08 00	 ret	 8
?UpdateSkeleton@CGrannyModelInstance@@QAEXPBUD3DXMATRIX@@M@Z ENDP ; CGrannyModelInstance::UpdateSkeleton
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ?UpdateTransform@CGrannyModelInstance@@QAEXPAUD3DXMATRIX@@M@Z
_TEXT	SEGMENT
_this$ = -4						; size = 4
_pMatrix$ = 8						; size = 4
_fSecondsElapsed$ = 12					; size = 4
?UpdateTransform@CGrannyModelInstance@@QAEXPAUD3DXMATRIX@@M@Z PROC ; CGrannyModelInstance::UpdateTransform, COMDAT
; _this$ = ecx

; 44   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 45   : 	if (!m_pgrnModelInstance)

  00007	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0000a	83 78 08 00	 cmp	 DWORD PTR [eax+8], 0
  0000e	75 0d		 jne	 SHORT $LN2@UpdateTran

; 46   : 	{
; 47   : 		TraceError("CGrannyModelIstance::UpdateTransform - m_pgrnModelInstance = NULL");

  00010	68 00 00 00 00	 push	 OFFSET ??_C@_0EC@DKCFBIDP@CGrannyModelIstance?3?3UpdateTran@
  00015	e8 00 00 00 00	 call	 ?TraceError@@YAXPBDZZ	; TraceError
  0001a	59		 pop	 ecx

; 48   : 		return;

  0001b	eb 1f		 jmp	 SHORT $LN1@UpdateTran
$LN2@UpdateTran:

; 49   : 	}
; 50   : 	GrannyUpdateModelMatrix(m_pgrnModelInstance, fSecondsElapsed, (const float *) pMatrix, (float *) pMatrix, false);

  0001d	6a 00		 push	 0
  0001f	ff 75 08	 push	 DWORD PTR _pMatrix$[ebp]
  00022	ff 75 08	 push	 DWORD PTR _pMatrix$[ebp]
  00025	51		 push	 ecx
  00026	f3 0f 10 45 0c	 movss	 xmm0, DWORD PTR _fSecondsElapsed$[ebp]
  0002b	f3 0f 11 04 24	 movss	 DWORD PTR [esp], xmm0
  00030	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00033	ff 70 08	 push	 DWORD PTR [eax+8]
  00036	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannyUpdateModelMatrix@20
$LN1@UpdateTran:

; 51   : 	//Tracef("%f %f %f",pMatrix->_41,pMatrix->_42,pMatrix->_43);
; 52   : 	
; 53   : }

  0003c	c9		 leave
  0003d	c2 08 00	 ret	 8
?UpdateTransform@CGrannyModelInstance@@QAEXPAUD3DXMATRIX@@M@Z ENDP ; CGrannyModelInstance::UpdateTransform
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ?UpdateLocalTime@CGrannyModelInstance@@QAEXM@Z
_TEXT	SEGMENT
_this$ = -4						; size = 4
_fElapsedTime$ = 8					; size = 4
?UpdateLocalTime@CGrannyModelInstance@@QAEXM@Z PROC	; CGrannyModelInstance::UpdateLocalTime, COMDAT
; _this$ = ecx

; 38   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	51		 push	 ecx
  00004	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 39   : 	m_fSecondsElapsed = fElapsedTime;

  00007	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  0000a	f3 0f 10 45 08	 movss	 xmm0, DWORD PTR _fElapsedTime$[ebp]
  0000f	f3 0f 11 40 24	 movss	 DWORD PTR [eax+36], xmm0

; 40   : 	m_fLocalTime += fElapsedTime;

  00014	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00017	f3 0f 10 40 20	 movss	 xmm0, DWORD PTR [eax+32]
  0001c	f3 0f 58 45 08	 addss	 xmm0, DWORD PTR _fElapsedTime$[ebp]
  00021	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00024	f3 0f 11 40 20	 movss	 DWORD PTR [eax+32], xmm0

; 41   : }

  00029	c9		 leave
  0002a	c2 04 00	 ret	 4
?UpdateLocalTime@CGrannyModelInstance@@QAEXM@Z ENDP	; CGrannyModelInstance::UpdateLocalTime
_TEXT	ENDS
; Function compile flags: /Odspy
; File D:\Metin2 Server Files\mainline\SRC_2014\Metin2Client\eterGrnLib\ModelInstanceUpdate.cpp
;	COMDAT ?Update@CGrannyModelInstance@@QAEXK@Z
_TEXT	SEGMENT
tv85 = -16						; size = 4
_c_dwCurUpdateFrame$ = -12				; size = 4
_ANIFPS_STEP$ = -8					; size = 4
_this$ = -4						; size = 4
_dwAniFPS$ = 8						; size = 4
?Update@CGrannyModelInstance@@QAEXK@Z PROC		; CGrannyModelInstance::Update, COMDAT
; _this$ = ecx

; 8    : {		

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 10	 sub	 esp, 16			; 00000010H
  00006	89 4d fc	 mov	 DWORD PTR _this$[ebp], ecx

; 9    : 	if (!dwAniFPS)

  00009	83 7d 08 00	 cmp	 DWORD PTR _dwAniFPS$[ebp], 0
  0000d	75 02		 jne	 SHORT $LN2@Update

; 10   : 		return;

  0000f	eb 6f		 jmp	 SHORT $LN1@Update
$LN2@Update:

; 11   : 
; 12   : 	const DWORD c_dwCurUpdateFrame = (DWORD) (GetLocalTime() * ANIFPS_MAX);

  00011	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  00014	e8 00 00 00 00	 call	 ?GetLocalTime@CGrannyModelInstance@@QAEMXZ ; CGrannyModelInstance::GetLocalTime
  00019	d9 5d f0	 fstp	 DWORD PTR tv85[ebp]
  0001c	f3 0f 10 45 f0	 movss	 xmm0, DWORD PTR tv85[ebp]
  00021	f3 0f 59 05 00
	00 00 00	 mulss	 xmm0, DWORD PTR __real@42f00000
  00029	e8 00 00 00 00	 call	 __ftoui3
  0002e	89 45 f4	 mov	 DWORD PTR _c_dwCurUpdateFrame$[ebp], eax

; 13   : 	const DWORD ANIFPS_STEP = ANIFPS_MAX/dwAniFPS;

  00031	6a 78		 push	 120			; 00000078H
  00033	58		 pop	 eax
  00034	33 d2		 xor	 edx, edx
  00036	f7 75 08	 div	 DWORD PTR _dwAniFPS$[ebp]
  00039	89 45 f8	 mov	 DWORD PTR _ANIFPS_STEP$[ebp], eax

; 14   : 	if (c_dwCurUpdateFrame>ANIFPS_STEP && c_dwCurUpdateFrame/ANIFPS_STEP==m_dwOldUpdateFrame/ANIFPS_STEP)

  0003c	8b 45 f4	 mov	 eax, DWORD PTR _c_dwCurUpdateFrame$[ebp]
  0003f	3b 45 f8	 cmp	 eax, DWORD PTR _ANIFPS_STEP$[ebp]
  00042	76 1b		 jbe	 SHORT $LN3@Update
  00044	8b 45 f4	 mov	 eax, DWORD PTR _c_dwCurUpdateFrame$[ebp]
  00047	33 d2		 xor	 edx, edx
  00049	f7 75 f8	 div	 DWORD PTR _ANIFPS_STEP$[ebp]
  0004c	8b c8		 mov	 ecx, eax
  0004e	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00051	8b 40 28	 mov	 eax, DWORD PTR [eax+40]
  00054	33 d2		 xor	 edx, edx
  00056	f7 75 f8	 div	 DWORD PTR _ANIFPS_STEP$[ebp]
  00059	3b c8		 cmp	 ecx, eax
  0005b	75 02		 jne	 SHORT $LN3@Update

; 15   : 		return;

  0005d	eb 21		 jmp	 SHORT $LN1@Update
$LN3@Update:

; 16   : 
; 17   : 	m_dwOldUpdateFrame=c_dwCurUpdateFrame;

  0005f	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00062	8b 4d f4	 mov	 ecx, DWORD PTR _c_dwCurUpdateFrame$[ebp]
  00065	89 48 28	 mov	 DWORD PTR [eax+40], ecx

; 18   : 
; 19   : 	//DWORD t1=timeGetTime();
; 20   : 	GrannySetModelClock(m_pgrnModelInstance, GetLocalTime());	

  00068	8b 4d fc	 mov	 ecx, DWORD PTR _this$[ebp]
  0006b	e8 00 00 00 00	 call	 ?GetLocalTime@CGrannyModelInstance@@QAEMXZ ; CGrannyModelInstance::GetLocalTime
  00070	51		 push	 ecx
  00071	d9 1c 24	 fstp	 DWORD PTR [esp]
  00074	8b 45 fc	 mov	 eax, DWORD PTR _this$[ebp]
  00077	ff 70 08	 push	 DWORD PTR [eax+8]
  0007a	ff 15 00 00 00
	00		 call	 DWORD PTR __imp__GrannySetModelClock@8
$LN1@Update:

; 21   : 	//DWORD t2=timeGetTime();
; 22   : 
; 23   : #ifdef __PERFORMANCE_CHECKER__
; 24   : 	{
; 25   : 		static FILE* fp=fopen("perf_grn_setmodelclock.txt", "w");
; 26   : 
; 27   : 		if (t2-t1>3)
; 28   : 		{
; 29   : 			fprintf(fp, "%f:%x:- GrannySetModelClock(time=%f) = %dms\n", timeGetTime()/1000.0f, this, GetLocalTime(), t2-t1);
; 30   : 			fflush(fp);
; 31   : 		}			
; 32   : 	}
; 33   : #endif	
; 34   : 
; 35   : }

  00080	c9		 leave
  00081	c2 04 00	 ret	 4
?Update@CGrannyModelInstance@@QAEXK@Z ENDP		; CGrannyModelInstance::Update
_TEXT	ENDS
END
